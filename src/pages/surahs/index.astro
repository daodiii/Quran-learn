---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Container from '../../components/primitives/Container.astro';
import CardGrid from '../../components/cards/CardGrid.astro';
import SurahCard from '../../components/cards/SurahCard.astro';
import { getCollection } from 'astro:content';

const allSurahs = await getCollection('surahs');
const sortedSurahs = allSurahs.sort((a, b) => a.data.surahNumber - b.data.surahNumber);

const beginnerSurahs = sortedSurahs.filter(s => s.data.difficulty === 'beginner');
const intermediateSurahs = sortedSurahs.filter(s => s.data.difficulty === 'intermediate');
const advancedSurahs = sortedSurahs.filter(s => s.data.difficulty === 'advanced');
---

<BaseLayout title="Surah Breakdowns">
  <Container maxWidth="xl" class="page-content">
    <!-- Page Header -->
    <header class="page-header">
      <h1 class="page-title">Surah Breakdowns</h1>
      <p class="page-description">
        Detailed word-by-word grammatical analysis of Quranic chapters.
        Each surah includes Arabic text, translation, I'rab analysis, and grammar cross-references.
      </p>

      <!-- Quick Navigation -->
      <nav class="quick-nav" aria-label="Jump to difficulty level">
        <span class="quick-nav-label">Jump to:</span>
        <a href="#beginner" class="quick-nav-link">Beginner</a>
        <a href="#intermediate" class="quick-nav-link">Intermediate</a>
        <a href="#advanced" class="quick-nav-link">Advanced</a>
      </nav>
    </header>

    <!-- Beginner Section -->
    {beginnerSurahs.length > 0 && (
      <section class="difficulty-section" id="beginner">
        <h2 class="section-title">Beginner</h2>
        <p class="section-description">
          Short surahs ideal for starting your grammatical analysis journey.
        </p>
        <CardGrid minCardWidth={300} gap="md">
          {beginnerSurahs.map((surah) => (
            <SurahCard
              name={surah.data.name}
              nameArabic={surah.data.nameArabic}
              number={surah.data.surahNumber}
              difficulty={surah.data.difficulty}
              verseCount={surah.data.verseCount}
              href={`/surahs/${surah.id}/`}
              data-testid={`surah-card-${surah.id}`}
            />
          ))}
        </CardGrid>
      </section>
    )}

    <!-- Intermediate Section -->
    {intermediateSurahs.length > 0 && (
      <section class="difficulty-section" id="intermediate">
        <h2 class="section-title">Intermediate</h2>
        <p class="section-description">
          Medium-length surahs with richer grammatical structures.
        </p>
        <CardGrid minCardWidth={300} gap="md">
          {intermediateSurahs.map((surah) => (
            <SurahCard
              name={surah.data.name}
              nameArabic={surah.data.nameArabic}
              number={surah.data.surahNumber}
              difficulty={surah.data.difficulty}
              verseCount={surah.data.verseCount}
              href={`/surahs/${surah.id}/`}
              data-testid={`surah-card-${surah.id}`}
            />
          ))}
        </CardGrid>
      </section>
    )}

    <!-- Advanced Section -->
    {advancedSurahs.length > 0 && (
      <section class="difficulty-section" id="advanced">
        <h2 class="section-title">Advanced</h2>
        <p class="section-description">
          Longer surahs with complex grammar and rhetorical devices.
        </p>
        <CardGrid minCardWidth={300} gap="md">
          {advancedSurahs.map((surah) => (
            <SurahCard
              name={surah.data.name}
              nameArabic={surah.data.nameArabic}
              number={surah.data.surahNumber}
              difficulty={surah.data.difficulty}
              verseCount={surah.data.verseCount}
              href={`/surahs/${surah.id}/`}
              data-testid={`surah-card-${surah.id}`}
            />
          ))}
        </CardGrid>
      </section>
    )}
  </Container>
</BaseLayout>

<style>
  .page-content {
    padding-block: var(--spacing-2xl);
  }

  /* Page Header */
  .page-header {
    margin-block-end: var(--spacing-2xl);
  }

  .page-title {
    font-size: 2.25rem;
    font-weight: 700;
    line-height: 1.2;
    color: var(--color-text-primary);
    margin: 0;
    margin-block-end: var(--spacing-sm);
  }

  .page-description {
    font-size: 1.125rem;
    line-height: 1.6;
    color: var(--color-text-secondary);
    margin: 0;
    margin-block-end: var(--spacing-lg);
    max-inline-size: 48rem;
  }

  /* Quick Navigation */
  .quick-nav {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: var(--spacing-md);
    padding: var(--spacing-md);
    background-color: var(--color-background-secondary);
    border-radius: 8px;
    border: 1px solid var(--color-border-primary);
  }

  .quick-nav-label {
    font-size: 0.9375rem;
    font-weight: 600;
    color: var(--color-text-secondary);
  }

  .quick-nav-link {
    font-size: 0.9375rem;
    font-weight: 500;
    color: var(--color-accent-gold);
    text-decoration: none;
    padding: var(--spacing-xs) var(--spacing-sm);
    border-radius: 4px;
    transition: background-color 200ms ease;
  }

  .quick-nav-link:hover {
    background-color: var(--color-background-tertiary);
  }

  .quick-nav-link:focus-visible {
    outline: 2px solid var(--color-accent-gold);
    outline-offset: 2px;
  }

  @media (prefers-reduced-motion: reduce) {
    .quick-nav-link {
      transition: none;
    }
  }

  /* Difficulty Sections */
  .difficulty-section {
    margin-block-end: var(--spacing-2xl);
  }

  .difficulty-section:last-child {
    margin-block-end: 0;
  }

  .section-title {
    font-size: 1.875rem;
    font-weight: 700;
    line-height: 1.2;
    color: var(--color-text-primary);
    margin: 0;
    margin-block-end: var(--spacing-xs);
  }

  .section-description {
    font-size: 0.9375rem;
    line-height: 1.5;
    color: var(--color-text-tertiary);
    margin: 0;
    margin-block-end: var(--spacing-lg);
  }

  /* Responsive Typography */
  @media (max-width: 640px) {
    .page-title {
      font-size: 1.875rem;
    }

    .page-description {
      font-size: 1rem;
    }

    .section-title {
      font-size: 1.5rem;
    }
  }
</style>
