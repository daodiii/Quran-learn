---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import Container from '../../../components/primitives/Container.astro';
import QuizComponent from '../../../components/Quiz.astro';
import { getCollection } from 'astro:content';

const LEVEL = 4;
const allLessons = await getCollection('lessons');
const levelLessons = allLessons.filter(l => l.data.level === LEVEL).sort((a, b) => a.data.order - b.data.order);
const nextLevelLessons = allLessons.filter(l => l.data.level === LEVEL + 1).sort((a, b) => a.data.order - b.data.order);
const prevLesson = levelLessons.length > 0 ? `/learn/${levelLessons[levelLessons.length - 1].id}/` : undefined;
const nextLesson = nextLevelLessons.length > 0 ? `/learn/${nextLevelLessons[0].id}/` : undefined;

const questions = [
  {
    id: 1,
    question: "What is the conditional particle 'if' in Arabic?",
    options: ["لو (law)", "إن (in)", "إذا (idha)", "All of the above"],
    correctAnswer: 3,
    explanation: "Arabic has multiple conditional particles: إن (general condition), إذا (when/if with certainty), لو (contrary to fact)."
  },
  {
    id: 2,
    question: "What is the difference between إن (in) and إذا (idha)?",
    options: [
      "No difference",
      "إن for uncertain, إذا for certain/likely conditions",
      "إذا for past only",
      "إن for present only"
    ],
    correctAnswer: 1,
    explanation: "إن expresses uncertain conditions ('if'), while إذا expresses more certain or likely conditions ('when/if')."
  },
  {
    id: 3,
    question: "What particle is used for exception (meaning 'except')?",
    options: ["لكن (laakin)", "إلا (illa)", "بل (bal)", "لولا (lawla)"],
    correctAnswer: 1,
    explanation: "إلا (illa) means 'except' and is the primary exception particle."
  },
  {
    id: 4,
    question: "What is Maf'ul Mutlaq (المفعول المطلق)?",
    options: [
      "Direct object",
      "Absolute/cognate object (same root as verb)",
      "Object of time",
      "Object of place"
    ],
    correctAnswer: 1,
    explanation: "Maf'ul Mutlaq is a verbal noun (masdar) from the same root as the verb, used to emphasize or describe the action."
  },
  {
    id: 5,
    question: "What is Maf'ul Fih (المفعول فيه)?",
    options: [
      "Object of time or place",
      "Direct object",
      "Indirect object",
      "Object of purpose"
    ],
    correctAnswer: 0,
    explanation: "Maf'ul Fih is the adverbial object indicating time (Zarf Zaman) or place (Zarf Makan)."
  },
  {
    id: 6,
    question: "What is Maf'ul Li-Ajlihi (المفعول لأجله)?",
    options: [
      "Object of result",
      "Object of purpose/reason",
      "Object of manner",
      "Object of accompaniment"
    ],
    correctAnswer: 1,
    explanation: "Maf'ul Li-Ajlihi indicates the reason or purpose for which an action is done."
  },
  {
    id: 7,
    question: "What is Maf'ul Ma'ahu (المفعول معه)?",
    options: [
      "Object of time",
      "Object of accompaniment (with)",
      "Direct object",
      "Object of place"
    ],
    correctAnswer: 1,
    explanation: "Maf'ul Ma'ahu indicates accompaniment, usually preceded by واو (waw) meaning 'with' or 'along with'."
  },
  {
    id: 8,
    question: "What grammatical term refers to the subject of a passive verb?",
    options: ["Fa'il", "Naib al-Fa'il", "Maf'ul Bihi", "Mubtada"],
    correctAnswer: 1,
    explanation: "Naib al-Fa'il (نائب الفاعل) is the 'deputy subject' - the object that takes the place of the omitted Fa'il in passive voice."
  },
  {
    id: 9,
    question: "What is التمييز (at-Tamyiz)?",
    options: [
      "The direct object",
      "The specification/clarification",
      "The predicate",
      "The adjective"
    ],
    correctAnswer: 1,
    explanation: "Tamyiz is a noun in the Mansub case that clarifies or specifies an ambiguous noun or number."
  },
  {
    id: 10,
    question: "What is الحال (al-Haal)?",
    options: [
      "The subject",
      "The circumstantial noun (describes state/manner)",
      "The predicate",
      "The object"
    ],
    correctAnswer: 1,
    explanation: "Haal is a noun in Mansub case describing the state or manner in which an action occurs (often translated with '-ly' adverbs or 'while')."
  }
];
---

<BaseLayout title="Level 4 Quiz - Advanced">
  <Container maxWidth="lg">
    <QuizComponent
      title="Level 4 Quiz: Advanced Grammar"
      questions={questions}
      passingScore={70}
      level={4}
    />
    <nav class="quiz-nav">
      {prevLesson ? (
        <a href={prevLesson} class="nav-link prev">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
          </svg>
          Previous Lesson
        </a>
      ) : <div></div>}
      {nextLesson ? (
        <a href={nextLesson} class="nav-link next">
          Next Lesson
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
          </svg>
        </a>
      ) : <div></div>}
    </nav>
  </Container>
</BaseLayout>

<style>
  .quiz-nav {
    display: flex;
    align-items: center;
    justify-content: space-between;
    max-inline-size: 85ch;
    margin-inline: auto;
    margin-top: 2rem;
    padding-top: 1.5rem;
    border-top: 1px solid var(--border-primary);
  }

  .nav-link {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    font-family: var(--font-display);
    font-size: 0.9375rem;
    font-weight: 600;
    color: var(--accent-gold);
    text-decoration: none;
    transition: all var(--transition-fast);
  }

  .nav-link:hover {
    opacity: 0.8;
  }

  .nav-link svg {
    width: 18px;
    height: 18px;
    transition: transform var(--transition-fast);
  }

  .nav-link.prev:hover svg {
    transform: translateX(-2px);
  }

  .nav-link.next:hover svg {
    transform: translateX(2px);
  }
</style>
