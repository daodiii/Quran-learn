---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import Container from '../../../components/primitives/Container.astro';
import QuizComponent from '../../../components/Quiz.astro';
import { getCollection } from 'astro:content';

const LEVEL = 2;
const allLessons = await getCollection('lessons');
const levelLessons = allLessons.filter(l => l.data.level === LEVEL).sort((a, b) => a.data.order - b.data.order);
const nextLevelLessons = allLessons.filter(l => l.data.level === LEVEL + 1).sort((a, b) => a.data.order - b.data.order);
const prevLesson = levelLessons.length > 0 ? `/learn/${levelLessons[levelLessons.length - 1].id}/` : undefined;
const nextLesson = nextLevelLessons.length > 0 ? `/learn/${nextLevelLessons[0].id}/` : undefined;

const questions = [
  {
    id: 1,
    question: "What are the three I'rab cases in Arabic?",
    options: ["Marfu', Mansub, Majrur", "Fatha, Kasra, Damma", "Mubtada, Khabar, Fa'il", "Ism, Fi'l, Harf"],
    correctAnswer: 0,
    explanation: "The three I'rab cases are Marfu' (nominative), Mansub (accusative), and Majrur (genitive)."
  },
  {
    id: 2,
    question: "What case marker indicates Marfu' for singular nouns?",
    options: ["Fatha", "Kasra", "Damma", "Sukun"],
    correctAnswer: 2,
    explanation: "Damma (ُ) indicates the Marfu' (nominative) case for singular nouns."
  },
  {
    id: 3,
    question: "What is Idafah (إضافة)?",
    options: [
      "A possessive construction",
      "A verb conjugation",
      "A sentence type",
      "A plural form"
    ],
    correctAnswer: 0,
    explanation: "Idafah is a possessive/genitive construction where two or more nouns are linked."
  },
  {
    id: 4,
    question: "In an Idafah construction, what case is the second noun (المضاف إليه)?",
    options: ["Marfu'", "Mansub", "Majrur", "Mabni"],
    correctAnswer: 2,
    explanation: "The second noun (Mudaf Ilayh) in an Idafah is always in the Majrur (genitive) case."
  },
  {
    id: 5,
    question: "What is the Fa'il (فاعل)?",
    options: ["The verb", "The subject/doer", "The object", "The predicate"],
    correctAnswer: 1,
    explanation: "Fa'il is the subject or doer of the verb in a verbal sentence."
  },
  {
    id: 6,
    question: "What case is the Fa'il always in?",
    options: ["Marfu'", "Mansub", "Majrur", "Mabni"],
    correctAnswer: 0,
    explanation: "The Fa'il (subject) is always in the Marfu' (nominative) case."
  },
  {
    id: 7,
    question: "What is the Maf'ul Bihi (مفعول به)?",
    options: ["The subject", "The direct object", "The predicate", "The verb"],
    correctAnswer: 1,
    explanation: "Maf'ul Bihi is the direct object that receives the action of the verb."
  },
  {
    id: 8,
    question: "What case is the Maf'ul Bihi in?",
    options: ["Marfu'", "Mansub", "Majrur", "Mabni"],
    correctAnswer: 1,
    explanation: "The Maf'ul Bihi (direct object) is in the Mansub (accusative) case."
  },
  {
    id: 9,
    question: "In a Nominal Sentence, what case is the Mubtada (المبتدأ) in?",
    options: ["Marfu'", "Mansub", "Majrur", "Mabni"],
    correctAnswer: 0,
    explanation: "The Mubtada (subject of nominal sentence) is in the Marfu' (nominative) case."
  },
  {
    id: 10,
    question: "What preposition (Harf Jarr) is used to indicate possession 'of' or 'for'?",
    options: ["في (fi)", "من (min)", "لِ (li)", "إلى (ila)"],
    correctAnswer: 2,
    explanation: "The preposition لِ (li) indicates possession, meaning 'of' or 'for'."
  }
];
---

<BaseLayout title="Level 2 Quiz - Core Grammar" description="Test your Core Grammar knowledge: nominal and verbal sentences, I'rab cases (Marfu', Mansub, Majrur), Idafah, adjective agreement, Inna and Kaana sisters.">
  <Container maxWidth="lg">
    <QuizComponent
      title="Level 2 Quiz: Core Grammar"
      questions={questions}
      passingScore={70}
      level={2}
    />
    <nav class="quiz-nav">
      {prevLesson ? (
        <a href={prevLesson} class="nav-link prev">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
          </svg>
          Previous Lesson
        </a>
      ) : <div></div>}
      {nextLesson ? (
        <a href={nextLesson} class="nav-link next">
          Next Lesson
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
          </svg>
        </a>
      ) : <div></div>}
    </nav>
  </Container>
</BaseLayout>

<style>
  .quiz-nav {
    display: flex;
    align-items: center;
    justify-content: space-between;
    max-inline-size: 85ch;
    margin-inline: auto;
    margin-top: 2rem;
    padding-top: 1.5rem;
    border-top: 1px solid var(--border-primary);
  }

  .nav-link {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    font-family: var(--font-display);
    font-size: 0.9375rem;
    font-weight: 600;
    color: var(--accent-gold);
    text-decoration: none;
    transition: all var(--transition-fast);
  }

  .nav-link:hover {
    opacity: 0.8;
  }

  .nav-link svg {
    width: 18px;
    height: 18px;
    transition: transform var(--transition-fast);
  }

  .nav-link.prev:hover svg {
    transform: translateX(-2px);
  }

  .nav-link.next:hover svg {
    transform: translateX(2px);
  }
</style>
