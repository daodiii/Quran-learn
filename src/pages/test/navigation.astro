---
import BaseLayout from '../../layouts/BaseLayout.astro';
import CourseNavigator from '../../components/navigation/CourseNavigator.astro';
import NavigatorToggle from '../../components/navigation/NavigatorToggle.astro';
import Breadcrumbs from '../../components/navigation/Breadcrumbs.astro';
import Container from '../../components/primitives/Container.astro';
import Button from '../../components/primitives/Button.astro';

const breadcrumbItems = [
  { label: 'Home', href: '/' },
  { label: 'Learn', href: '/learn/' },
  { label: 'Level 1', href: '/learn/#level-1' },
  { label: 'Arabic Alphabet' }
];

const title = 'Navigation System Test';
---

<BaseLayout title={title} description="Visual testing for navigation components: sidebar, breadcrumbs, toggles, keyboard navigation">
  <!-- Backdrop for mobile -->
  <div id="navigator-backdrop" class="navigator-backdrop" data-testid="navigator-backdrop"></div>

  <Container maxWidth="none">
    <div class="test-layout">
      <!-- Sidebar section -->
      <aside class="test-sidebar" data-testid="sidebar-section">
        <CourseNavigator currentLessonSlug="level-1/01-arabic-alphabet" />
      </aside>

      <!-- Main content section -->
      <main class="test-main">
        <header class="page-header">
          <h1>Navigation System Test</h1>
          <p>Testing navigation components: sidebar, breadcrumbs, keyboard interactions, and mobile overlay</p>
          <Button id="theme-toggle" variant="outline" size="sm">Toggle Theme</Button>
        </header>

        <!-- Breadcrumbs section -->
        <section class="test-section" data-testid="breadcrumbs-section">
          <h2>Breadcrumbs (LTR)</h2>
          <p class="section-description">Standard left-to-right breadcrumbs with "/" separator</p>
          <Breadcrumbs items={breadcrumbItems} />
        </section>

        <!-- RTL Breadcrumbs section -->
        <section class="test-section" dir="rtl" data-testid="breadcrumbs-rtl-section">
          <h2>Breadcrumbs (RTL)</h2>
          <p class="section-description">Right-to-left breadcrumbs with "<" separator (flipped via CSS)</p>
          <Breadcrumbs items={breadcrumbItems} />
        </section>

        <!-- Navigator Toggle section -->
        <section class="test-section" data-testid="toggle-section">
          <h2>Navigator Toggle Variants</h2>
          <p class="section-description">Toggle buttons for showing/hiding sidebar navigation</p>

          <div class="toggle-variants">
            <div class="variant-demo">
              <h3>Header Variant</h3>
              <p>Visible on tablet/mobile only (&lt;1024px)</p>
              <div class="demo-box">
                <NavigatorToggle variant="header" />
              </div>
            </div>
            <div class="variant-demo">
              <h3>Floating Variant</h3>
              <p>Fixed position with accent color background</p>
              <div class="demo-box">
                <div style="position: relative; height: 80px;">
                  <NavigatorToggle variant="floating" />
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Keyboard Navigation Instructions -->
        <section class="test-section" data-testid="keyboard-section">
          <h2>Keyboard Navigation Test</h2>
          <p class="section-description">Test these keyboard interactions:</p>
          <ul class="keyboard-list">
            <li><kbd>Tab</kbd> - Navigate through sidebar links</li>
            <li><kbd>Enter</kbd> / <kbd>Space</kbd> - Activate focused link or button</li>
            <li><kbd>Escape</kbd> - Close mobile sidebar overlay</li>
            <li><kbd>Arrow Right</kbd> - Expand collapsed level section (LTR)</li>
            <li><kbd>Arrow Left</kbd> - Collapse expanded level section (LTR)</li>
          </ul>
        </section>

        <!-- Mobile Testing Instructions -->
        <section class="test-section" data-testid="mobile-section">
          <h2>Mobile Overlay Test</h2>
          <p class="section-description">Resize to mobile viewport (&lt;1024px) to test:</p>
          <ul class="test-list">
            <li>Floating toggle button appears in bottom-left corner</li>
            <li>Click toggle to open sidebar overlay from left</li>
            <li>Backdrop appears with semi-transparent overlay</li>
            <li>Click backdrop or press Escape to close sidebar</li>
            <li>Focus trap keeps Tab within sidebar when open</li>
          </ul>
        </section>

        <!-- Level Section States -->
        <section class="test-section" data-testid="level-states-section">
          <h2>Level Section States</h2>
          <p class="section-description">Test expand/collapse functionality:</p>
          <ul class="test-list">
            <li>Level 1 should be expanded (contains current lesson)</li>
            <li>Other levels should be collapsed initially</li>
            <li>Click level header to toggle expand/collapse</li>
            <li>Verify aria-expanded attribute changes</li>
            <li>State persists via localStorage</li>
          </ul>
        </section>
      </main>
    </div>
  </Container>

  <!-- Floating toggle for mobile testing (always visible on this test page) -->
  <NavigatorToggle variant="floating" />
</BaseLayout>

<style>
  .test-layout {
    display: grid;
    grid-template-columns: 280px 1fr;
    gap: 2rem;
    padding: 2rem;
    max-inline-size: 90rem;
    margin-inline: auto;
  }

  @media (max-width: 1023px) {
    .test-layout {
      grid-template-columns: 1fr;
    }

    .test-sidebar {
      display: none;
    }
  }

  .test-sidebar {
    position: sticky;
    inset-block-start: 2rem;
    align-self: start;
  }

  .test-main {
    min-inline-size: 0; /* Prevent grid blowout */
  }

  .page-header {
    margin-block-end: 2rem;
  }

  .page-header h1 {
    font-size: 2rem;
    font-weight: 700;
    margin-block-end: 0.5rem;
    color: var(--text-primary);
  }

  .page-header p {
    font-size: 1rem;
    color: var(--text-secondary);
    margin-block-end: 1rem;
  }

  .test-section {
    background: var(--bg-elevated);
    border: 1px solid var(--border-primary);
    border-radius: var(--radius-xl);
    padding: 1.5rem;
    margin-block-end: 1.5rem;
  }

  .test-section h2 {
    font-size: 1.25rem;
    font-weight: 600;
    margin-block-end: 0.5rem;
    color: var(--text-primary);
  }

  .test-section h3 {
    font-size: 0.9375rem;
    font-weight: 500;
    margin-block-end: 0.5rem;
    color: var(--text-secondary);
  }

  .section-description {
    font-size: 0.875rem;
    color: var(--text-secondary);
    margin-block-end: 1rem;
  }

  .toggle-variants {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-block-start: 1rem;
  }

  .variant-demo {
    border: 1px solid var(--border-secondary);
    border-radius: var(--radius-lg);
    padding: 1rem;
  }

  .variant-demo p {
    font-size: 0.8125rem;
    color: var(--text-tertiary);
    margin-block-end: 0.75rem;
  }

  .demo-box {
    background: var(--bg-secondary);
    border-radius: var(--radius-md);
    padding: 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    min-block-size: 60px;
  }

  .keyboard-list,
  .test-list {
    list-style: disc;
    padding-inline-start: 1.5rem;
    margin-block-start: 0.75rem;
  }

  .keyboard-list li,
  .test-list li {
    font-size: 0.9375rem;
    color: var(--text-secondary);
    margin-block-end: 0.5rem;
    line-height: 1.6;
  }

  kbd {
    display: inline-block;
    padding: 0.125rem 0.375rem;
    font-size: 0.875rem;
    font-family: var(--font-mono, monospace);
    color: var(--text-primary);
    background: var(--bg-secondary);
    border: 1px solid var(--border-primary);
    border-radius: var(--radius-sm);
    box-shadow: 0 1px 0 var(--border-secondary);
  }

  /* Backdrop styling */
  .navigator-backdrop {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: 39;
    opacity: 0;
    pointer-events: none;
    transition: opacity 300ms ease;
  }

  .navigator-backdrop.visible {
    opacity: 1;
    pointer-events: auto;
  }

  /* Force floating toggle visible for testing on all viewports */
  :global(.navigator-toggle--floating) {
    display: flex !important;
  }

  /* Accessibility: reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .navigator-backdrop {
      transition: none;
    }
  }
</style>

<script>
  // Theme toggle functionality
  const themeToggle = document.getElementById('theme-toggle');
  themeToggle?.addEventListener('click', () => {
    const currentTheme = document.documentElement.getAttribute('data-theme');
    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
    document.documentElement.setAttribute('data-theme', newTheme);
    localStorage.setItem('theme', newTheme);
  });
</script>
