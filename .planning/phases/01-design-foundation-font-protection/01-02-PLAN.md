---
phase: 01-design-foundation-font-protection
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/styles/tokens/colors.css
  - src/styles/tokens/spacing.css
  - src/styles/tokens/typography.css
  - src/styles/tokens/shadows.css
  - src/styles/global.css
autonomous: true

must_haves:
  truths:
    - "Design tokens use semantic CTI naming convention"
    - "Tailwind utilities (bg-*, text-*, space-*) generate from @theme tokens"
    - "Light and dark modes apply via CSS variable scoping, not Tailwind dark: classes"
  artifacts:
    - path: "src/styles/tokens/colors.css"
      provides: "@theme color tokens with semantic naming"
      contains: "@theme"
    - path: "src/styles/tokens/spacing.css"
      provides: "@theme spacing and radius tokens"
      contains: "--space-"
    - path: "src/styles/tokens/typography.css"
      provides: "@theme font family and size tokens"
      contains: "--font-"
    - path: "src/styles/tokens/shadows.css"
      provides: "@theme shadow tokens"
      contains: "--shadow-"
  key_links:
    - from: "src/styles/global.css"
      to: "src/styles/tokens/*.css"
      via: "@import"
      pattern: '@import.*tokens/'
    - from: "src/styles/tokens/colors.css"
      to: ":root CSS variables"
      via: "var() references"
      pattern: "var\\(--bg-|var\\(--text-|var\\(--accent-"
---

<objective>
Migrate existing CSS custom properties to modular Tailwind 4 @theme token files with semantic CTI naming.

Purpose: The existing global.css has 115+ CSS variables already defined in :root and [data-theme="dark"]. Converting them to @theme tokens enables automatic utility class generation (bg-background-primary, text-accent-primary, etc.) while preserving the existing dark mode approach.

Output: Modular token files (colors.css, spacing.css, typography.css, shadows.css) with semantic naming, integrated via imports in global.css.
</objective>

<execution_context>
@/Users/daodilyas/.claude/get-shit-done/workflows/execute-plan.md
@/Users/daodilyas/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/Users/daodilyas/quran-learn/.planning/PROJECT.md
@/Users/daodilyas/quran-learn/.planning/phases/01-design-foundation-font-protection/01-RESEARCH.md
@/Users/daodilyas/quran-learn/src/styles/global.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create modular token files with @theme blocks</name>
  <files>src/styles/tokens/colors.css, src/styles/tokens/spacing.css, src/styles/tokens/typography.css, src/styles/tokens/shadows.css</files>
  <action>
Create `src/styles/tokens/` directory with 4 files:

**1. colors.css** - Semantic color tokens that reference existing CSS variables:
```css
/* Color tokens - reference CSS variables for theme switching */
@theme {
  /* Background semantic tokens */
  --color-background-primary: var(--bg-primary);
  --color-background-secondary: var(--bg-secondary);
  --color-background-tertiary: var(--bg-tertiary);
  --color-background-elevated: var(--bg-elevated);

  /* Text semantic tokens */
  --color-text-primary: var(--text-primary);
  --color-text-secondary: var(--text-secondary);
  --color-text-tertiary: var(--text-tertiary);
  --color-text-inverse: var(--text-inverse);

  /* Border semantic tokens */
  --color-border-primary: var(--border-primary);
  --color-border-secondary: var(--border-secondary);
  --color-border-focus: var(--border-focus);

  /* Accent semantic tokens - reference theme-aware variables */
  --color-accent-primary: var(--accent-primary);
  --color-accent-primary-hover: var(--accent-primary-hover);
  --color-accent-primary-light: var(--accent-primary-light);
  --color-accent-secondary: var(--accent-secondary);
  --color-accent-gold: var(--accent-gold);
  --color-accent-coral: var(--accent-coral);
  --color-accent-sage: var(--accent-sage);
  --color-accent-purple: var(--accent-purple);

  /* Level colors for progress badges */
  --color-level-1-bg: var(--level-1-bg);
  --color-level-1-border: var(--level-1-border);
  --color-level-1-text: var(--level-1-text);
  /* ... repeat for levels 2-5 */
}
```

**2. spacing.css** - Spacing, radius, and sizing tokens:
```css
@theme {
  /* Spacing scale */
  --space-xs: var(--space-xs);
  --space-sm: var(--space-sm);
  --space-md: var(--space-md);
  --space-lg: var(--space-lg);
  --space-xl: var(--space-xl);
  --space-2xl: var(--space-2xl);
  --space-3xl: var(--space-3xl);

  /* Border radius */
  --radius-sm: var(--radius-sm);
  --radius-md: var(--radius-md);
  --radius-lg: var(--radius-lg);
  --radius-xl: var(--radius-xl);
  --radius-2xl: var(--radius-2xl);
  --radius-full: var(--radius-full);
}
```

**3. typography.css** - Font family and Arabic-specific tokens:
```css
@theme {
  /* Font families */
  --font-family-sans: var(--font-sans);
  --font-family-arabic: var(--font-arabic);

  /* Note: --font-sans and --font-arabic are already defined in existing @theme block */
}
```

**4. shadows.css** - Shadow tokens:
```css
@theme {
  /* Base shadows (already partially defined) */
  --shadow-xs: var(--shadow-xs);
  --shadow-sm: var(--shadow-sm);
  --shadow-md: var(--shadow-md);
  --shadow-lg: var(--shadow-lg);
  --shadow-xl: var(--shadow-xl);
}
```

IMPORTANT: These @theme tokens REFERENCE the CSS variables defined in :root and [data-theme="dark"]. This enables Tailwind utility generation while preserving theme switching.
  </action>
  <verify>
1. All 4 files exist in src/styles/tokens/
2. Each file contains @theme block
3. `grep -r "var(--" src/styles/tokens/` shows CSS variable references
  </verify>
  <done>
Four token files created with @theme blocks referencing existing CSS variables
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate token files into global.css</name>
  <files>src/styles/global.css</files>
  <action>
Modify global.css to import token files and consolidate @theme usage:

1. Add imports after the tailwindcss import (line 1) and fonts import:
```css
@import "tailwindcss";
@import "./fonts.css";
@import "./tokens/colors.css";
@import "./tokens/spacing.css";
@import "./tokens/typography.css";
@import "./tokens/shadows.css";
```

2. KEEP the existing :root and [data-theme="dark"] blocks (lines 9-199) - these define the base CSS variables

3. UPDATE the existing @theme block (lines 277-359) to:
   - Remove tokens that are now defined in token files (avoid duplication)
   - Keep the color scale definitions (primary-50 through primary-900, etc.) as they're static
   - Keep --font-sans and --font-arabic definitions

4. KEEP all @layer base and @layer components blocks unchanged

The result: CSS variables in :root/:dark provide values, @theme tokens in separate files generate utilities, existing component styles remain intact.
  </action>
  <verify>
1. `head -10 src/styles/global.css` shows all imports
2. `npm run build` succeeds
3. Start dev server and inspect a page - verify Tailwind utilities work:
   - `bg-background-primary` applies background color
   - `text-accent-primary` applies teal color
   - Colors change when toggling dark mode
  </verify>
  <done>
global.css imports token files, @theme blocks generate utilities, dark mode switching works
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify utility generation and dark mode</name>
  <files>None (verification only)</files>
  <action>
Create a simple verification by:

1. Start the dev server: `npm run dev`

2. Open browser DevTools and verify in the Styles panel:
   - Search for `.bg-background-primary` - should have rule with background-color
   - Search for `.text-accent-primary` - should have rule with color
   - Search for `.space-md` or `gap-md` - should show spacing value

3. Test dark mode switching:
   - In console, run: `document.documentElement.setAttribute('data-theme', 'dark')`
   - Verify page colors change
   - Run: `document.documentElement.removeAttribute('data-theme')`
   - Verify page returns to light mode

4. Verify Arabic fonts still render:
   - Navigate to any page with Arabic text
   - Inspect .arabic element - should show font-family includes 'KFGQPC Hafs Uthmani'

If any utility doesn't generate, check:
- Token naming follows namespace pattern (--color-* for colors, --space-* for spacing)
- Imports are in correct order
- Dev server was restarted after CSS changes
  </action>
  <verify>
1. Browser DevTools shows generated utility classes
2. Dark mode toggle changes colors via CSS variable updates
3. Arabic text renders with correct font family
4. No console errors about missing CSS
  </verify>
  <done>
Tailwind utilities generate correctly, dark mode works, Arabic fonts render properly
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Token structure:
   - `ls src/styles/tokens/` shows 4 files
   - Each file has @theme block with semantic naming

2. Import chain:
   - global.css imports: tailwindcss -> fonts.css -> tokens/*.css

3. Utility generation:
   - `npm run build` succeeds
   - Build output includes generated utilities

4. Theme switching:
   - Dark mode works via [data-theme="dark"] attribute
   - Colors update without page reload
</verification>

<success_criteria>
1. src/styles/tokens/ contains colors.css, spacing.css, typography.css, shadows.css
2. Each token file has @theme block with semantic CTI naming
3. global.css imports all token files
4. Tailwind utilities (bg-background-*, text-*, space-*) generate correctly
5. Dark mode works via existing [data-theme="dark"] approach
6. `npm run build` succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/01-design-foundation-font-protection/01-02-SUMMARY.md`
</output>
