---
phase: 01-design-foundation-font-protection
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/styles/fonts.css
  - src/styles/global.css
  - tests/font-checksums.json
  - package.json
autonomous: true

must_haves:
  truths:
    - "Arabic font files are checksummed for change detection"
    - "Font declarations are isolated in dedicated file"
    - "global.css imports fonts.css without modification to @font-face rules"
  artifacts:
    - path: "src/styles/fonts.css"
      provides: "All @font-face declarations for Arabic fonts"
      contains: "@font-face"
    - path: "tests/font-checksums.json"
      provides: "SHA-256 checksums for all 9 font files"
      min_lines: 10
  key_links:
    - from: "src/styles/global.css"
      to: "src/styles/fonts.css"
      via: "@import"
      pattern: '@import.*fonts\.css'
---

<objective>
Protect Arabic font infrastructure by isolating font declarations and capturing baseline checksums before any design system changes.

Purpose: The 9 Arabic font files (UthmanicHafs + 8 Amiri variants) and their @font-face declarations are critical infrastructure. Isolating them prevents accidental modification during token migration. Checksums enable automated verification that fonts remain unchanged.

Output: fonts.css with protected @font-face rules, font-checksums.json with SHA-256 hashes, Playwright installed for visual regression.
</objective>

<execution_context>
@/Users/daodilyas/.claude/get-shit-done/workflows/execute-plan.md
@/Users/daodilyas/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/Users/daodilyas/quran-learn/.planning/PROJECT.md
@/Users/daodilyas/quran-learn/.planning/ROADMAP.md
@/Users/daodilyas/quran-learn/.planning/phases/01-design-foundation-font-protection/01-RESEARCH.md
@/Users/daodilyas/quran-learn/src/styles/global.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extract font declarations to fonts.css</name>
  <files>src/styles/fonts.css, src/styles/global.css</files>
  <action>
Create `src/styles/fonts.css` containing:
1. A header comment marking this file as PROTECTED/IMMUTABLE
2. All @font-face declarations from global.css lines 201-275 (KFGQPC Hafs Uthmani + all 8 Amiri variants)
3. Comments explaining unicode-range purpose for Arabic vs Latin subsets

Then modify global.css:
1. Add `@import "./fonts.css";` after the `@import "tailwindcss";` line (line 1)
2. Remove the @font-face declarations (lines 201-275) since they now live in fonts.css
3. Keep everything else unchanged

IMPORTANT: Copy @font-face rules EXACTLY - do not modify font-family names, unicode-range values, or file paths. The font declarations are production-tested.
  </action>
  <verify>
1. `cat src/styles/fonts.css | grep -c "@font-face"` returns 9 (1 UthmanicHafs + 8 Amiri)
2. `cat src/styles/global.css | grep -c "@font-face"` returns 0
3. `cat src/styles/global.css | grep "@import.*fonts.css"` shows the import
4. `npm run build` succeeds without errors
  </verify>
  <done>
fonts.css contains all 9 @font-face declarations, global.css imports it, build passes
  </done>
</task>

<task type="auto">
  <name>Task 2: Capture font file checksums and install Playwright</name>
  <files>tests/font-checksums.json, package.json</files>
  <action>
1. Create `tests/font-checksums.json` with SHA-256 checksums for all 9 font files in `public/fonts/`:
   - UthmanicHafs.woff2
   - amiri-regular-arabic.woff2
   - amiri-regular-latin.woff2
   - amiri-bold-arabic.woff2
   - amiri-bold-latin.woff2
   - amiri-italic-arabic.woff2
   - amiri-italic-latin.woff2
   - amiri-bolditalic-arabic.woff2
   - amiri-bolditalic-latin.woff2

Use Node.js crypto to generate checksums:
```javascript
const crypto = require('crypto');
const fs = require('fs');
const hash = crypto.createHash('sha256').update(fs.readFileSync(filepath)).digest('hex');
```

Format as JSON:
```json
{
  "generated": "2026-02-05",
  "purpose": "Baseline checksums for Arabic font protection verification",
  "files": {
    "public/fonts/UthmanicHafs.woff2": "sha256-hash-here",
    ...
  }
}
```

2. Install Playwright for visual regression testing:
   `npm install --save-dev @playwright/test`

3. Run `npx playwright install chromium` to download browser binaries
  </action>
  <verify>
1. `cat tests/font-checksums.json | grep -c "sha256"` returns 9 (one per font file, plus key prefix)
2. `npm list @playwright/test` shows package installed
3. `ls node_modules/.cache/ms-playwright/` confirms browser downloaded
  </verify>
  <done>
font-checksums.json has SHA-256 for all 9 fonts, Playwright installed with Chromium browser
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Font isolation verified:
   - `grep -c "@font-face" src/styles/fonts.css` = 9
   - `grep -c "@font-face" src/styles/global.css` = 0

2. Build integrity:
   - `npm run build` passes
   - No CSS errors or warnings about missing fonts

3. Checksum baseline:
   - tests/font-checksums.json exists with 9 entries
   - All checksums are 64-character hex strings (SHA-256)

4. Visual regression ready:
   - `npx playwright --version` shows installed version
</verification>

<success_criteria>
1. Font declarations extracted to src/styles/fonts.css (9 @font-face rules)
2. global.css imports fonts.css and contains no @font-face rules
3. tests/font-checksums.json contains SHA-256 hashes for all 9 font files
4. Playwright test framework installed
5. `npm run build` succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/01-design-foundation-font-protection/01-01-SUMMARY.md`
</output>
