---
phase: 17-quality-assurance-validation
plan: 04
type: execute
wave: 2
depends_on: ["17-01", "17-02"]
files_modified:
  - scripts/generate-qa-report.ts
  - scripts/validate-content.ts
  - package.json
  - .planning/phases/17-quality-assurance-validation/qa-report.md
autonomous: true

must_haves:
  truths:
    - "QA report generator orchestrates all validators (diacritics, terminology, verses, cross-lesson, glossary links, readability) into a single consolidated report"
    - "Running npm run qa:full produces a comprehensive markdown QA report"
    - "validate-content.ts orchestrator includes the new cross-lesson, glossary, and readability validators"
    - "QA report includes per-section results, severity counts, and actionable next steps"
    - "A QA report is generated and committed as an artifact for audit trail"
  artifacts:
    - path: "scripts/generate-qa-report.ts"
      provides: "Consolidated QA report generator running all validators"
      exports: ["generateQAReport"]
    - path: "package.json"
      provides: "npm scripts for QA validation commands"
      contains: "qa:full"
    - path: ".planning/phases/17-quality-assurance-validation/qa-report.md"
      provides: "Generated QA validation report with findings"
      contains: "Quality Assurance Report"
  key_links:
    - from: "scripts/generate-qa-report.ts"
      to: "scripts/validate-cross-lesson.ts"
      via: "imports validateCrossLesson"
      pattern: "import.*validate-cross-lesson"
    - from: "scripts/generate-qa-report.ts"
      to: "scripts/validate-glossary-links.ts"
      via: "imports validateGlossaryLinks"
      pattern: "import.*validate-glossary-links"
    - from: "scripts/generate-qa-report.ts"
      to: "scripts/validate-readability.ts"
      via: "imports validateReadability"
      pattern: "import.*validate-readability"
---

<objective>
Create a consolidated QA report generator that orchestrates all validators (existing + new) into a single comprehensive report, update package.json with QA npm scripts, enhance validate-content.ts to include new validators, then run the full validation suite and generate the QA report.

Purpose: This plan delivers the final QA artifact - a comprehensive validation report that documents the state of all 73 lessons and 6 resources. It connects all validator outputs into one actionable document.
Output: generate-qa-report.ts, updated validate-content.ts, updated package.json, qa-report.md
</objective>

<execution_context>
@/Users/daodilyas/.claude/get-shit-done/workflows/execute-plan.md
@/Users/daodilyas/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-quality-assurance-validation/17-RESEARCH.md

@scripts/validate-content.ts
@scripts/validate-diacritics.ts
@scripts/validate-terminology.ts
@scripts/validate-verses.ts

# Need summaries from Plans 01 and 02 for the new validator APIs
@.planning/phases/17-quality-assurance-validation/17-01-SUMMARY.md
@.planning/phases/17-quality-assurance-validation/17-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create QA report generator and update package.json scripts</name>
  <files>scripts/generate-qa-report.ts, scripts/validate-content.ts, package.json</files>
  <action>
**Part A: Create scripts/generate-qa-report.ts**

Create a report generator that orchestrates all six validators and produces a consolidated markdown report. Use Node.js built-ins only.

```typescript
import { writeFileSync, readFileSync, readdirSync, statSync } from 'fs';
import { join, dirname } from 'path';
import { fileURLToPath } from 'url';
import { validateDiacritics } from './validate-diacritics.js';
import { validateTerminology } from './validate-terminology.js';
import { validateVerses } from './validate-verses.js';
import { validateCrossLesson } from './validate-cross-lesson.js';
import { validateGlossaryLinks } from './validate-glossary-links.js';
import { validateReadability } from './validate-readability.js';
```

**Implementation:**

1. **Find all content files** (lessons + resources) using the same findMdxFiles pattern

2. **Run single-file validators** (diacritics, terminology, verses) on each file, collecting results per file

3. **Run cross-file validators** (cross-lesson, glossary links, readability) once across the corpus

4. **Aggregate results** into sections:
   - Executive summary (total files, total issues, critical vs warning counts)
   - Per-validator section with issue counts and details
   - Readability metrics table (per-level averages from readability validator)
   - Expert review status (always "PENDING" in automated report)
   - Actionable next steps

5. **Generate markdown report** and write to `.planning/phases/17-quality-assurance-validation/qa-report.md`

6. **Print summary to console** showing total issues by category

7. **Exit codes:** 0 = no critical issues, 1 = critical issues found

**Report structure:**
```markdown
# Quality Assurance Report

**Generated:** YYYY-MM-DD
**Content Scope:** 73 lessons, 6 resources

## Executive Summary
| Metric | Count |
| Total Issues | N |
| Critical Errors | N |
| Warnings | N |

## Diacritics Validation
[per-file results]

## Terminology Validation
[per-file results]

## Verse Reference Validation
[per-file results]

## Cross-Lesson Consistency
[cross-lesson issues]

## Glossary Link Validation
[link issues]

## Readability & Difficulty Progression
[metrics table + progression issues]

## Expert Review Status
- Arabic Linguist Review: PENDING
- Muslim Educator Review: PENDING
- Review Checklist: expert-review-checklist.md

## Next Steps
[actionable items based on findings]
```

Target under 300 lines.

**Part B: Update scripts/validate-content.ts**

Add imports and calls for the three new validators to the main orchestrator:
- Import `validateCrossLesson` from `./validate-cross-lesson.js`
- Import `validateGlossaryLinks` from `./validate-glossary-links.js`
- Import `validateReadability` from `./validate-readability.js`

After the existing per-file validation loop (line 128), add a new section that:
1. Runs `validateCrossLesson()` and reports results
2. Runs `validateGlossaryLinks()` and reports results
3. Runs `validateReadability()` and reports metrics summary
4. Adds any errors/warnings from these to the totalErrors/totalWarnings counts

**Part C: Update package.json scripts**

Add these npm scripts:
```json
"qa:full": "npx tsx scripts/generate-qa-report.ts",
"qa:cross-lesson": "npx tsx scripts/validate-cross-lesson.ts",
"qa:glossary-links": "npx tsx scripts/validate-glossary-links.ts",
"qa:readability": "npx tsx scripts/validate-readability.ts"
```

Add them after the existing `validate:verses` script entry. Keep all existing scripts unchanged.
  </action>
  <verify>
Verify the report generator works:
```bash
npx tsx scripts/generate-qa-report.ts 2>&1 | tail -20
```
Verify package.json has new scripts:
```bash
grep "qa:" package.json
```
Verify validate-content.ts includes new validators:
```bash
grep "validateCrossLesson\|validateGlossaryLinks\|validateReadability" scripts/validate-content.ts
```
  </verify>
  <done>
- scripts/generate-qa-report.ts exists and runs all 6 validators
- package.json has qa:full, qa:cross-lesson, qa:glossary-links, qa:readability scripts
- validate-content.ts imports and runs the 3 new validators
  </done>
</task>

<task type="auto">
  <name>Task 2: Run full QA validation and generate report</name>
  <files>.planning/phases/17-quality-assurance-validation/qa-report.md</files>
  <action>
Execute the full QA validation suite and generate the consolidated report:

1. Run `npx tsx scripts/generate-qa-report.ts` to produce the QA report

2. Review the generated report at `.planning/phases/17-quality-assurance-validation/qa-report.md`

3. If the report generator fails due to bugs in the new validators:
   - Debug and fix the specific validator that failed
   - Re-run the report generator
   - Document any fixes made

4. After successful generation, review the report contents:
   - Verify it has all 6 validation sections
   - Verify the executive summary counts are reasonable
   - Verify the readability metrics table shows data for all 5 levels
   - Verify the next steps section is actionable

5. The qa-report.md is the primary QA artifact for this phase. It will be committed to version control for audit trail.

If there are critical issues in the report (e.g., many diacritics errors, broken links), this is EXPECTED and CORRECT behavior - the report documents the current state, it doesn't need to show zero issues. The report itself is the deliverable, not a clean bill of health.
  </action>
  <verify>
Verify the report was generated:
```bash
ls -la .planning/phases/17-quality-assurance-validation/qa-report.md
head -30 .planning/phases/17-quality-assurance-validation/qa-report.md
```
Report should exist with non-zero content and start with "# Quality Assurance Report".
  </verify>
  <done>
- qa-report.md exists with comprehensive validation results
- Report covers all 6 validation categories
- Report includes executive summary with issue counts
- Report includes readability metrics per level
- Report includes expert review status (PENDING)
- Report includes actionable next steps
  </done>
</task>

</tasks>

<verification>
1. `npm run qa:full` runs successfully and produces qa-report.md
2. `npm run validate` (existing orchestrator) runs with new validators included
3. `npm run qa:cross-lesson` runs standalone
4. `npm run qa:glossary-links` runs standalone
5. `npm run qa:readability` runs standalone
6. qa-report.md has all 6 validation sections
7. qa-report.md has readability metrics table for all 5 levels
</verification>

<success_criteria>
- Complete QA report generated documenting the state of 73 lessons + 6 resources
- All validators (existing + new) integrated into single orchestrator
- npm scripts provide convenient access to individual and full QA runs
- QA report artifact committed to version control for audit trail
- Report includes clear next steps for expert review process
</success_criteria>

<output>
After completion, create `.planning/phases/17-quality-assurance-validation/17-04-SUMMARY.md`
</output>
