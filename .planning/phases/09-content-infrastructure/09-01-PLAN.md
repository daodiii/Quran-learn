---
phase: 09-content-infrastructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/content.config.ts
  - src/content/lessons/level-1/_index.mdx
  - src/content/lessons/level-2/_index.mdx
  - src/content/lessons/level-3/_index.mdx
  - src/content/lessons/level-4/_index.mdx
  - src/content/lessons/level-5/_index.mdx
autonomous: true

must_haves:
  truths:
    - "Build succeeds with content.config.ts defining lessons and resources collections"
    - "Lesson frontmatter with title, level, order is validated at build time"
    - "Invalid frontmatter (missing title, level out of range) causes build error"
    - "Lesson directory structure exists with level-1 through level-5 subdirectories"
    - "getCollection('lessons') returns entries sorted by level and order"
  artifacts:
    - path: "src/content.config.ts"
      provides: "Content collection definitions with Zod schemas for lessons and resources"
      exports: ["collections"]
      contains: "defineCollection"
    - path: "src/content/lessons/level-1/_index.mdx"
      provides: "Seed lesson file for Level 1 to validate schema"
    - path: "src/content/lessons/level-2/_index.mdx"
      provides: "Seed lesson file for Level 2 to validate schema"
    - path: "src/content/lessons/level-3/_index.mdx"
      provides: "Seed lesson file for Level 3 to validate schema"
    - path: "src/content/lessons/level-4/_index.mdx"
      provides: "Seed lesson file for Level 4 to validate schema"
    - path: "src/content/lessons/level-5/_index.mdx"
      provides: "Seed lesson file for Level 5 to validate schema"
  key_links:
    - from: "src/content.config.ts"
      to: "src/content/lessons/"
      via: "glob() loader with base path"
      pattern: "glob\\(.*base.*lessons"
    - from: "src/pages/learn/[...slug].astro"
      to: "src/content.config.ts"
      via: "getCollection('lessons')"
      pattern: "getCollection.*lessons"
---

<objective>
Create the content collection schema and lesson directory structure that validates lesson frontmatter at build time and enables all 73 lessons to be authored as MDX files.

Purpose: This is the foundation for all lesson content. Without a validated schema, lesson content can have missing fields, wrong types, or broken metadata that only surfaces at runtime. The schema catches these errors at build time.

Output: `src/content.config.ts` with Zod schemas for lessons and resources collections, plus `src/content/lessons/level-{1-5}/` directories each containing a seed lesson file to validate the pipeline works end-to-end.
</objective>

<execution_context>
@/Users/daodilyas/.claude/get-shit-done/workflows/execute-plan.md
@/Users/daodilyas/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-content-infrastructure/09-RESEARCH.md

Key codebase files to reference:
@src/pages/learn/[...slug].astro — already uses getCollection('lessons'), render(entry), entry.id, entry.data.level, entry.data.order, entry.data.title, entry.data.titleArabic, entry.data.description, entry.data.prevLesson, entry.data.nextLesson
@src/layouts/LessonLayout.astro — expects title, titleArabic, level, description, nextLesson, prevLesson props
@src/content/resources/glossary.mdx — existing resource frontmatter pattern (title, order, description)
@src/pages/learn/index.astro — uses getCollection('lessons'), data.level to filter
@astro.config.mjs — confirms MDX integration is already configured
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create content.config.ts with Zod schemas for lessons and resources</name>
  <files>src/content.config.ts</files>
  <action>
    Create `src/content.config.ts` (NOT `src/content/config.ts` — Astro v5 changed the location).

    Define two collections:

    **lessons collection:**
    - loader: `glob({ pattern: '**/[^_]*.{md,mdx}', base: './src/content/lessons' })`
    - Schema fields (derived from existing usage in `[...slug].astro` and `LessonLayout.astro`):
      - `title`: z.string() — required, lesson title in English
      - `titleArabic`: z.string().optional() — Arabic title
      - `level`: z.number().int().min(1).max(5) — required, which level (1-5)
      - `order`: z.number().int().positive() — required, sequence within level
      - `description`: z.string().optional() — lesson summary
      - `draft`: z.boolean().default(false) — whether to exclude from builds
      - `prevLesson`: z.string().optional() — manual override for previous lesson link
      - `nextLesson`: z.string().optional() — manual override for next lesson link

    **resources collection:**
    - loader: `glob({ pattern: '**/*.{md,mdx}', base: './src/content/resources' })`
    - Schema fields (derived from existing resource MDX frontmatter):
      - `title`: z.string() — required
      - `order`: z.number().int().positive().optional() — display order
      - `description`: z.string().optional()

    Import from `astro:content` and `astro/loaders`. Export `collections` object with both collections.

    Do NOT use `z.date()` — use `z.coerce.date()` if date fields are ever needed (Astro v5 pitfall).
    Do NOT use `type: 'content'` — that's the legacy Astro v4 API. Use `loader` property.
  </action>
  <verify>
    Run `cd /Users/daodilyas/quran-learn && npx astro check 2>&1 | head -30` — should not show schema-related errors.
    Verify file exists at `src/content.config.ts` (not `src/content/config.ts`).
  </verify>
  <done>
    `src/content.config.ts` exists with lessons and resources collections defined using glob() loaders and Zod schemas. All fields match what existing pages expect from `entry.data.*`.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create lesson directory structure with seed MDX files per level</name>
  <files>
    src/content/lessons/level-1/_index.mdx
    src/content/lessons/level-2/_index.mdx
    src/content/lessons/level-3/_index.mdx
    src/content/lessons/level-4/_index.mdx
    src/content/lessons/level-5/_index.mdx
  </files>
  <action>
    Create 5 directories: `src/content/lessons/level-{1-5}/`

    In each directory, create a `_index.mdx` file with valid frontmatter that passes the schema defined in Task 1. Use underscore prefix so the glob pattern `[^_]*` excludes these seed files from the actual lesson collection (they are scaffolding, not real lessons).

    Each `_index.mdx` should contain:
    ```
    ---
    title: "Level N Placeholder"
    level: N
    order: 0
    description: "Seed file for directory structure validation"
    draft: true
    ---

    This is a placeholder file. Real lessons will be created in Phase 12-16.
    ```

    Replace N with 1, 2, 3, 4, 5 respectively.

    After creating all files, run `npx astro build` to verify:
    1. The content.config.ts is picked up correctly
    2. The glob loader finds the lesson directory structure
    3. The existing resource MDX files still work with the new resources collection
    4. The build completes without errors

    If the build fails because `getCollection('lessons')` returns empty (since seed files are excluded by the glob pattern), that's expected and correct. The `[...slug].astro` page will just generate no routes. What matters is no schema/config errors.

    NOTE: If the build fails due to the `getCollection('lessons')` returning empty causing issues in pages that expect at least one lesson, create ONE non-underscore-prefixed test lesson instead. Name it `level-1/01-placeholder.mdx` with:
    ```
    ---
    title: "Welcome to Quranic Arabic"
    level: 1
    order: 1
    description: "Introduction to the course structure and learning approach."
    draft: false
    ---

    # Welcome to Quranic Arabic Grammar

    This lesson will be filled with content in Phase 12.
    ```
  </action>
  <verify>
    Run `cd /Users/daodilyas/quran-learn && npx astro build 2>&1 | tail -20` — build must succeed.
    Verify directories exist: `ls src/content/lessons/level-{1,2,3,4,5}/`
  </verify>
  <done>
    Five level directories exist under `src/content/lessons/`. Build succeeds with content.config.ts picking up the directory structure. Existing resource pages still work. The project is ready for lesson MDX files to be added in Phases 12-16.
  </done>
</task>

</tasks>

<verification>
1. `src/content.config.ts` exists at the correct location (root of src/, NOT inside src/content/)
2. `npx astro build` succeeds without errors
3. Five directories exist: `src/content/lessons/level-{1,2,3,4,5}/`
4. Schema validates required fields (title, level, order) and rejects invalid data at build time
5. Existing pages (`/learn/`, `/resources/`, homepage) continue to work
</verification>

<success_criteria>
- content.config.ts defines lessons collection with glob loader pointing to src/content/lessons
- content.config.ts defines resources collection with glob loader pointing to src/content/resources
- Zod schema validates title (string), level (int 1-5), order (positive int) as required fields
- All 5 level directories exist with seed files
- `npx astro build` completes successfully
- No TypeScript errors related to content collections
</success_criteria>

<output>
After completion, create `.planning/phases/09-content-infrastructure/09-01-SUMMARY.md`
</output>
