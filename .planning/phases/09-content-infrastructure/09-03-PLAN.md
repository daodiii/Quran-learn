---
phase: 09-content-infrastructure
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/mdx/GrammarTable.astro
  - src/components/mdx/VerbConjugation.astro
  - src/components/mdx/ExerciseBox.astro
autonomous: true

must_haves:
  truths:
    - "GrammarTable renders responsive tables with RTL support that stack on mobile"
    - "VerbConjugation displays verb paradigm tables with root, pattern, person, tense columns"
    - "ExerciseBox provides practice questions with accessible show/hide answer toggles"
    - "All three components use CSS custom properties and logical properties"
    - "ExerciseBox toggle works with keyboard (Enter/Space) and announces state to screen readers"
  artifacts:
    - path: "src/components/mdx/GrammarTable.astro"
      provides: "Responsive grammar paradigm tables with RTL and mobile stacking"
      min_lines: 60
    - path: "src/components/mdx/VerbConjugation.astro"
      provides: "Verb conjugation display with structured data props"
      min_lines: 50
    - path: "src/components/mdx/ExerciseBox.astro"
      provides: "Interactive exercise with show/hide answer toggle"
      min_lines: 60
  key_links:
    - from: "src/components/mdx/ExerciseBox.astro"
      to: "browser"
      via: "client-side script for toggle"
      pattern: "addEventListener.*click"
    - from: "src/components/mdx/GrammarTable.astro"
      to: "src/styles/tokens/colors.css"
      via: "CSS custom properties"
      pattern: "var\\(--color-"
---

<objective>
Create the GrammarTable, VerbConjugation, and ExerciseBox educational components that lesson authors will use for paradigm tables, verb conjugation displays, and interactive practice exercises.

Purpose: These three components handle the structured data aspects of grammar education. Tables display paradigms (case endings, pronoun charts), verb conjugation shows form patterns, and exercises provide active recall practice. Together with ArabicExample and Callout (Plan 02), they complete the component library needed to author all 73 lessons.

Output: Three Astro components in `src/components/mdx/` ready for import into MDX lesson files.
</objective>

<execution_context>
@/Users/daodilyas/.claude/get-shit-done/workflows/execute-plan.md
@/Users/daodilyas/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/09-content-infrastructure/09-RESEARCH.md

Key codebase files to reference:
@src/components/mdx/ResponsiveImage.astro — existing MDX component pattern
@src/components/Quiz.astro — existing interactive component with client-side JS (reference for script patterns, event handling)
@src/styles/tokens/colors.css — CSS custom property names
@src/styles/tokens/spacing.css — spacing tokens
@src/layouts/LessonLayout.astro — existing table styles in .lesson-content :global(table) — new components should visually harmonize
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create GrammarTable and VerbConjugation components</name>
  <files>
    src/components/mdx/GrammarTable.astro
    src/components/mdx/VerbConjugation.astro
  </files>
  <action>
    **GrammarTable.astro:**

    A responsive table component designed for Arabic grammar paradigms (case endings, pronoun charts, declension patterns).

    Props interface:
    ```typescript
    interface Props {
      caption?: string;
      headers: string[];
      rows: string[][];
      rtl?: boolean;  // Default true — most grammar tables have Arabic content
    }
    ```

    Component structure:
    - Outer `<div class="table-wrapper">` with `overflow-x: auto` for horizontal scroll on small screens
    - `<table class="grammar-table">` with `dir` attribute based on `rtl` prop (default "rtl")
    - Optional `<caption>` if caption prop provided
    - `<thead>` with header row
    - `<tbody>` — first cell of each row is `<th scope="row">` (row header), rest are `<td>`
    - Add `data-label` attributes to `<td>` elements matching their column header (for mobile stacking)

    Styling:
    - Full width table with collapsed borders
    - Header row: `var(--color-background-tertiary)` background, `var(--color-text-primary)` text, 600 weight
    - Body cells: `var(--color-text-secondary)`, subtle bottom border
    - Row hover: `var(--color-background-secondary)` background
    - All text in table: `letter-spacing: 0` (critical for Arabic content)
    - `text-align: start` (logical property) for all cells
    - Mobile (max-width: 640px): Hide thead, display each row as a block card, each td shows its header label via `::before` pseudo-element using `content: attr(data-label)`
    - Use design system tokens: `--color-*`, `--spacing-*`, `--radius-*`
    - Wrapper border: `1px solid var(--color-border-primary)`, `border-radius: var(--radius-md)`

    Usage example (comment at top):
    ```mdx
    <GrammarTable
      caption="Personal Pronouns"
      headers={["Person", "Arabic", "Transliteration", "English"]}
      rows={[
        ["1st Singular", "أَنَا", "ana", "I"],
        ["2nd Singular (m)", "أَنْتَ", "anta", "you (m)"],
        ["2nd Singular (f)", "أَنْتِ", "anti", "you (f)"],
      ]}
    />
    ```

    **VerbConjugation.astro:**

    A specialized table component for Arabic verb conjugation displays. Wraps GrammarTable with a verb-specific header showing the root and form.

    Props interface:
    ```typescript
    interface Props {
      root: string;          // Arabic root letters (e.g., "ك ت ب")
      form?: string;         // Verb form (e.g., "Form I", "Form II")
      pattern?: string;      // Morphological pattern (e.g., "فَعَلَ")
      headers: string[];     // Column headers for the conjugation table
      rows: string[][];      // Conjugation data rows
    }
    ```

    Component structure:
    - Outer `<div class="verb-conjugation">` card container
    - Header section with root display (large, RTL Arabic), form label, and pattern
    - Root displayed in accent color, large font, `dir="rtl"`, `letter-spacing: 0`
    - Pattern displayed in `var(--font-arabic)` alongside form label
    - Below header: render the same table structure as GrammarTable (copy the table markup, don't import GrammarTable — avoid component-in-component complexity for Astro MDX). The table is always RTL.
    - Style the table identically to GrammarTable but within the `.verb-conjugation` scope

    Usage example (comment at top):
    ```mdx
    <VerbConjugation
      root="ك ت ب"
      form="Form I"
      pattern="فَعَلَ"
      headers={["Person", "Past", "Present", "Verbal Noun"]}
      rows={[
        ["He", "كَتَبَ", "يَكْتُبُ", "كِتَابَة"],
        ["She", "كَتَبَتْ", "تَكْتُبُ", "—"],
        ["They (m)", "كَتَبُوا", "يَكْتُبُونَ", "—"],
      ]}
    />
    ```

    Both components are zero-JS Astro components (no client-side scripting needed).
  </action>
  <verify>
    Files exist at `src/components/mdx/GrammarTable.astro` and `src/components/mdx/VerbConjugation.astro`.
    GrammarTable: Has Props with headers/rows arrays, responsive mobile styles with @media query, data-label attributes.
    VerbConjugation: Has Props with root/form/pattern/headers/rows, displays root in Arabic with RTL.
    Both: CSS custom properties only, logical properties only, letter-spacing: 0 on table cells.
  </verify>
  <done>
    GrammarTable.astro renders responsive paradigm tables with RTL support and mobile card stacking. VerbConjugation.astro renders verb-specific tables with root/form header and conjugation data. Both use design system tokens and zero client-side JS.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create ExerciseBox component with accessible show/hide toggle</name>
  <files>src/components/mdx/ExerciseBox.astro</files>
  <action>
    Create `src/components/mdx/ExerciseBox.astro` — an interactive exercise component with a show/hide answer toggle.

    This is the ONE component in the MDX library that requires client-side JavaScript (for the toggle interaction).

    Props interface:
    ```typescript
    interface Props {
      question: string;
      id?: string;
    }
    ```

    Component structure:
    - Outer `<div class="exercise-box">` card container
    - Question: `<p class="exercise-question">{question}</p>`
    - Toggle button: `<button type="button" class="toggle-answer" aria-expanded="false" aria-controls="answer-{id}">` with:
      - `<span class="toggle-text">Show Answer</span>`
      - `<span class="toggle-icon" aria-hidden="true">` with a chevron/arrow SVG (inline, small)
    - Answer panel: `<div class="exercise-answer" id="answer-{id}" hidden>` with `<slot />` for MDX content
    - Generate unique ID if not provided: use `crypto.randomUUID()` or `Math.random().toString(36).substr(2, 9)`

    **Accessibility requirements (critical):**
    - `aria-expanded` toggles between "true" and "false"
    - `aria-controls` links button to answer panel by ID
    - `hidden` attribute on answer panel (not CSS display:none — `hidden` is semantically correct)
    - Button text changes: "Show Answer" / "Hide Answer"
    - Chevron icon rotates 180deg when expanded
    - `prefers-reduced-motion: reduce` — disable chevron rotation animation

    **Client-side script:**
    - Use `document.addEventListener('astro:page-load', initExercises)` to support Astro view transitions
    - Also call `initExercises()` immediately for initial load
    - `initExercises()` queries all `.toggle-answer` buttons, adds click handlers
    - Click handler: toggle `aria-expanded`, toggle `hidden` on answer panel, update button text
    - Use event delegation or direct binding — keep it simple

    **Styling:**
    - Card container: `var(--color-background-secondary)` background, `var(--color-border-primary)` border, `var(--radius-md)` corners
    - Question: 500 weight, primary text color, comfortable line-height
    - Toggle button: `var(--color-accent-primary)` background, white text, 600 weight, flex with gap for icon, hover state with `var(--color-accent-primary-hover)`, focus-visible outline
    - Answer panel: top border separator when visible, `var(--spacing-md)` top margin/padding
    - Chevron transition: `transform 300ms cubic-bezier(0.4, 0, 0.2, 1)` (respects prefers-reduced-motion)

    Usage example (comment at top):
    ```mdx
    <ExerciseBox question="What is the definite article in Arabic?">
      The definite article is **al-** (الـ). It is prefixed directly to the noun.

      <ArabicExample
        arabic="الْكِتَابُ"
        translation="the book"
        reference="Example"
      />
    </ExerciseBox>
    ```
  </action>
  <verify>
    File exists at `src/components/mdx/ExerciseBox.astro`.
    Contains: `aria-expanded`, `aria-controls`, `hidden` attribute on answer panel.
    Contains: `<slot />` for answer content.
    Contains: `<script>` block with toggle logic.
    Contains: `astro:page-load` event listener for view transition support.
    Contains: `prefers-reduced-motion` media query.
    Contains: CSS custom properties (no hardcoded colors).
  </verify>
  <done>
    ExerciseBox.astro is a fully accessible interactive component with show/hide answer toggle. Supports keyboard navigation, screen reader announcements via aria-expanded, Astro view transitions, and reduced motion preferences. Uses slot for rich MDX answer content (can include ArabicExample, tables, etc.).
  </done>
</task>

</tasks>

<verification>
1. All three components exist in `src/components/mdx/`
2. GrammarTable and VerbConjugation are zero-JS (no `<script>` tag)
3. ExerciseBox has client-side JS with proper ARIA attributes
4. All use CSS custom properties from the design system
5. All use CSS logical properties (no left/right)
6. All have `letter-spacing: 0` on elements containing Arabic text
7. GrammarTable has responsive mobile stacking with @media query
8. ExerciseBox respects `prefers-reduced-motion`
</verification>

<success_criteria>
- GrammarTable renders tables with headers/rows props, responsive mobile card layout, RTL support
- VerbConjugation displays verb root/form header with conjugation table below
- ExerciseBox has accessible show/hide toggle with aria-expanded, aria-controls, hidden attribute
- ExerciseBox toggle works after Astro view transitions (astro:page-load event)
- All three components use design system tokens consistently
- Complete MDX educational component library: 5 components (ArabicExample, Callout, GrammarTable, VerbConjugation, ExerciseBox) + existing ResponsiveImage = 6 total
</success_criteria>

<output>
After completion, create `.planning/phases/09-content-infrastructure/09-03-SUMMARY.md`
</output>
