---
phase: 03-card-components-arabic-typography
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/pages/test/cards.astro
  - tests/cards.spec.ts
autonomous: true

must_haves:
  truths:
    - "Test page displays all 4 card types in responsive grids"
    - "Arabic text in cards does not break mid-word at any viewport"
    - "Cards transition smoothly on hover (or instant with reduced-motion)"
    - "Dark mode shows visible hover states on all cards"
    - "Progress indicators render correctly inside cards"
  artifacts:
    - path: "src/pages/test/cards.astro"
      provides: "Visual test page for all card components"
      contains: ["CardGrid", "CourseCard", "LessonCard", "SurahCard", "ResourceCard"]
    - path: "tests/cards.spec.ts"
      provides: "Playwright tests for card behavior"
      contains: ["test", "expect"]
  key_links:
    - from: "src/pages/test/cards.astro"
      to: "src/components/cards/"
      via: "import statements"
      pattern: "import.*from.*cards/"
    - from: "tests/cards.spec.ts"
      to: "src/pages/test/cards.astro"
      via: "page.goto('/test/cards')"
      pattern: "goto.*test/cards"
---

<objective>
Create test page showcasing all card components in various states, plus Playwright tests verifying responsive behavior, Arabic text wrapping, dark mode, and accessibility.

Purpose: Validate Phase 3 success criteria with automated tests before moving to Phase 4.

Output: Test page at /test/cards and Playwright test suite in tests/cards.spec.ts.
</objective>

<execution_context>
@/Users/daodilyas/.claude/get-shit-done/workflows/execute-plan.md
@/Users/daodilyas/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/Users/daodilyas/quran-learn/.planning/PROJECT.md
@/Users/daodilyas/quran-learn/.planning/ROADMAP.md
@/Users/daodilyas/quran-learn/.planning/STATE.md
@/Users/daodilyas/quran-learn/.planning/phases/03-card-components-arabic-typography/03-RESEARCH.md

# Prior plan summary
@/Users/daodilyas/quran-learn/.planning/phases/03-card-components-arabic-typography/03-01-SUMMARY.md

# Existing test patterns
@/Users/daodilyas/quran-learn/src/pages/test/components.astro
@/Users/daodilyas/quran-learn/tests/components.spec.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create card components test page</name>
  <files>src/pages/test/cards.astro</files>
  <action>
Create comprehensive test page following Phase 2 pattern from src/pages/test/components.astro:

```astro
---
import CardGrid from '../../components/cards/CardGrid.astro';
import CourseCard from '../../components/cards/CourseCard.astro';
import LessonCard from '../../components/cards/LessonCard.astro';
import SurahCard from '../../components/cards/SurahCard.astro';
import ResourceCard from '../../components/cards/ResourceCard.astro';
import Container from '../../components/primitives/Container.astro';

const title = 'Card Components Test';
---
```

Page sections with data-testid attributes:

**Section 1: CardGrid Responsive Test**
- data-testid="card-grid-section"
- 6 simple cards to demonstrate 1/2/3 column behavior
- Each card: data-testid="grid-card-{n}"

**Section 2: CourseCard Variants**
- data-testid="course-card-section"
- 5 CourseCards (one per level)
- Mix of progress states: 0%, 25%, 50%, 75%, 100%
- data-testid="course-card-level-{1-5}"

**Section 3: LessonCard Variants**
- data-testid="lesson-card-section"
- 4 LessonCards with Arabic titles
- Include completed and incomplete states
- data-testid="lesson-card-completed", "lesson-card-incomplete"
- Arabic titles examples:
  - "الدرس الأول: المبتدأ والخبر"
  - "الدرس الثاني: الفعل والفاعل"
  - "الجملة الاسمية"
  - "الجملة الفعلية"

**Section 4: SurahCard Grid**
- data-testid="surah-card-section"
- 6 SurahCards with all 3 difficulty levels
- Mix of real surah data:
  - Al-Fatiha (1, الفاتحة, beginner, 7 verses)
  - Al-Baqarah (2, البقرة, advanced, 286 verses)
  - Al-Ikhlas (112, الإخلاص, beginner, 4 verses)
- data-testid="surah-card-{number}"

**Section 5: ResourceCard Grid**
- data-testid="resource-card-section"
- 4 ResourceCards with different icons (use inline SVG in icon slot)
- data-testid="resource-card-{n}"

Wrap page in Container (maxWidth="xl") with dark mode toggle button.
  </action>
  <verify>File exists at src/pages/test/cards.astro, imports all 5 card components, has all data-testid attributes listed</verify>
  <done>Test page at /test/cards displays all card types in grids with Arabic text examples</done>
</task>

<task type="auto">
  <name>Task 2: Create Playwright tests for cards</name>
  <files>tests/cards.spec.ts</files>
  <action>
Create Playwright test suite following Phase 2 patterns from tests/components.spec.ts:

```typescript
import { test, expect } from '@playwright/test';

const BASE_URL = 'http://localhost:4321';
```

**Test Groups:**

1. **CardGrid Responsive Layout** (describe block)
   - Test 3 columns at 1200px viewport
   - Test 2 columns at 700px viewport
   - Test 1 column at 400px viewport
   - Use `page.setViewportSize()` before each check
   - Verify with CSS Grid computed styles or element positions

2. **Arabic Text Wrapping** (describe block)
   - Navigate to /test/cards at 320px viewport (narrow mobile)
   - Get all elements with dir="rtl" attribute
   - For each: verify no horizontal overflow beyond card boundary
   - Verify overflow-wrap computed style is 'break-word' or 'anywhere'
   - Test: Arabic text does not have word-break: break-all

3. **Progress Integration** (describe block)
   - Verify CourseCard contains role="progressbar"
   - Verify LessonCard contains role="img" (checkmark)
   - Check aria-valuenow matches expected progress values

4. **Dark Mode Styling** (describe block)
   - Set data-theme="dark" on html element
   - Hover over clickable card
   - Verify box-shadow changes (not same as unhovered)
   - Verify text remains readable (contrast check via computed color)

5. **Visual Regression** (describe block)
   - Screenshot card-grid-section at 1200px
   - Screenshot lesson-card-section (for Arabic text)
   - Screenshot in dark mode
   - Use maxDiffPixels: 100 tolerance (same as Phase 2)

6. **Accessibility** (describe block)
   - All cards with href are focusable via Tab
   - Focus-visible outline appears on keyboard focus
   - aria-label or visible text exists for all interactive cards

Run configuration:
```bash
npx playwright test tests/cards.spec.ts --reporter=list
```
  </action>
  <verify>File exists at tests/cards.spec.ts with all 6 describe blocks, imports Playwright test/expect</verify>
  <done>Playwright tests pass for responsive layout, Arabic text, progress integration, dark mode, visual regression, and accessibility</done>
</task>

<task type="auto">
  <name>Task 3: Run tests and capture baselines</name>
  <files>tests/cards.spec.ts-snapshots/</files>
  <action>
Execute Playwright tests and capture visual regression baselines:

1. Start dev server (if not running):
```bash
cd /Users/daodilyas/quran-learn && npm run dev &
sleep 3
```

2. Run tests with update-snapshots for first run:
```bash
npx playwright test tests/cards.spec.ts --update-snapshots --reporter=list
```

3. Verify all tests pass:
```bash
npx playwright test tests/cards.spec.ts --reporter=list
```

4. Check snapshot files created:
```bash
ls tests/cards.spec.ts-snapshots/
```

If any tests fail:
- For Arabic text overflow: verify overflow-wrap in component CSS
- For responsive layout: check minmax() values in CardGrid
- For dark mode: ensure --shadow-medium token is defined for dark theme
- For accessibility: add missing aria-labels

Fix any issues in the components (Plan 01 files) before marking complete.
  </action>
  <verify>`npx playwright test tests/cards.spec.ts` passes all tests, snapshot files exist in tests/cards.spec.ts-snapshots/</verify>
  <done>All Playwright tests pass, visual regression baselines captured</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Test page accessible:
```bash
curl -s http://localhost:4321/test/cards | grep -o 'data-testid' | wc -l
# Should show 20+ data-testid attributes
```

2. All Playwright tests pass:
```bash
cd /Users/daodilyas/quran-learn && npx playwright test tests/cards.spec.ts --reporter=list
# All tests should show green checkmarks
```

3. Visual baselines exist:
```bash
ls tests/cards.spec.ts-snapshots/*.png 2>/dev/null | wc -l
# Should show 3+ snapshot files
```

4. Arabic text verification (manual via test):
```bash
grep -c "overflow-wrap: break-word" src/components/cards/LessonCard.astro src/components/cards/SurahCard.astro
# Both files should show count of 1+
```
</verification>

<success_criteria>
- Test page exists at /test/cards with all 5 card component types
- 20+ data-testid attributes for precise test targeting
- Playwright tests cover: responsive layout, Arabic text, progress, dark mode, visual regression, accessibility
- All tests pass green
- Visual regression baselines captured
- No Arabic text overflow at 320px viewport
- Cards show visible hover states in dark mode
</success_criteria>

<output>
After completion, create `.planning/phases/03-card-components-arabic-typography/03-02-SUMMARY.md`
</output>
