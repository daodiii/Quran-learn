---
phase: 05-navigation-system
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/navigation/CourseNavigator.astro
  - src/components/navigation/NavigatorToggle.astro
autonomous: true

must_haves:
  truths:
    - "CourseNavigator displays all 5 levels with collapsible sections"
    - "Each lesson shows title and completion checkmark when applicable"
    - "Active lesson is visually highlighted with aria-current=page"
    - "Level sections can be expanded/collapsed with proper ARIA"
    - "Navigator toggle button controls sidebar visibility on mobile"
  artifacts:
    - path: "src/components/navigation/CourseNavigator.astro"
      provides: "Full course navigator with all lessons"
      min_lines: 150
      contains: "aria-label=\"Course navigation\""
    - path: "src/components/navigation/NavigatorToggle.astro"
      provides: "Toggle button for mobile sidebar"
      min_lines: 30
      contains: "aria-expanded"
  key_links:
    - from: "src/components/navigation/CourseNavigator.astro"
      to: "getCollection('lessons')"
      via: "Astro content collection query"
      pattern: "getCollection\\(['\"]lessons['\"]\\)"
    - from: "src/components/navigation/CourseNavigator.astro"
      to: "LessonCheckmark"
      via: "Component import for completion indicator"
      pattern: "import.*LessonCheckmark"
---

<objective>
Create CourseNavigator sidebar and NavigatorToggle button components

Purpose: Build the main navigation component that shows all 73 lessons across 5 levels with progress tracking
Output: CourseNavigator.astro with collapsible levels, NavigatorToggle.astro for mobile control
</objective>

<execution_context>
@/Users/daodilyas/.claude/get-shit-done/workflows/execute-plan.md
@/Users/daodilyas/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-navigation-system/05-RESEARCH.md

@src/components/Sidebar.astro
@src/components/progress/LessonCheckmark.astro
@src/lib/progress.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CourseNavigator component</name>
  <files>src/components/navigation/CourseNavigator.astro</files>
  <action>
Create CourseNavigator.astro that displays ALL lessons across ALL levels (unlike existing Sidebar which only shows current level).

Structure:
```astro
---
import { getCollection } from 'astro:content';
import LessonCheckmark from '../progress/LessonCheckmark.astro';

interface Props {
  currentLessonSlug?: string;
}

const { currentLessonSlug } = Astro.props;
const currentPath = Astro.url.pathname;

const allLessons = await getCollection('lessons');

// Group by level
const lessonsByLevel: Record<number, typeof allLessons> = {
  1: [], 2: [], 3: [], 4: [], 5: []
};
allLessons.forEach(lesson => {
  if (lessonsByLevel[lesson.data.level]) {
    lessonsByLevel[lesson.data.level].push(lesson);
  }
});

// Sort each level by order
Object.keys(lessonsByLevel).forEach(level => {
  lessonsByLevel[Number(level)].sort((a, b) => a.data.order - b.data.order);
});

const levelNames: Record<number, string> = {
  1: 'Foundation',
  2: 'Core Grammar',
  3: 'Intermediate',
  4: 'Advanced',
  5: 'Applied Study',
};

const levelColors: Record<number, string> = {
  1: '#3b82f6',
  2: '#22c55e',
  3: '#eab308',
  4: '#ef4444',
  5: '#8b5cf6',
};
---

<nav class="course-navigator" aria-label="Course navigation" id="course-navigator">
  <div class="navigator-header">
    <h2 class="navigator-title">Course Navigator</h2>
    <button class="close-navigator" id="close-navigator" aria-label="Close navigator">
      <svg><!-- X icon --></svg>
    </button>
  </div>

  <div class="navigator-content">
    {Object.entries(lessonsByLevel).map(([level, lessons]) => {
      const levelNum = Number(level);
      const hasActiveLesson = lessons.some(l => currentPath.includes(l.id));
      return (
        <section class="level-section" data-level={level}>
          <button
            class="level-header"
            aria-expanded={hasActiveLesson ? "true" : "false"}
            aria-controls={`level-${level}-lessons`}
          >
            <span class="level-dot" style={`background-color: ${levelColors[levelNum]}`}></span>
            <span class="level-info">
              <span class="level-name">Level {level}: {levelNames[levelNum]}</span>
              <span class="level-count">{lessons.length} lessons</span>
            </span>
            <svg class="chevron" aria-hidden="true"><!-- chevron-right --></svg>
          </button>

          <ol id={`level-${level}-lessons`} class="lesson-list" hidden={!hasActiveLesson}>
            {lessons.map(lesson => {
              const lessonPath = `/learn/${lesson.id}/`;
              const isActive = currentPath === lessonPath || currentPath === `/learn/${lesson.id}`;
              return (
                <li>
                  <a
                    href={lessonPath}
                    class:list={['lesson-item', { active: isActive }]}
                    aria-current={isActive ? 'page' : undefined}
                  >
                    <span class="lesson-number">{lesson.data.order}</span>
                    <span class="lesson-title">{lesson.data.title}</span>
                    <LessonCheckmark completed={false} size="sm" />
                  </a>
                </li>
              );
            })}
          </ol>
        </section>
      );
    })}
  </div>

  <!-- Quiz links at bottom -->
  <div class="navigator-footer">
    <h3 class="quiz-heading">Level Quizzes</h3>
    <div class="quiz-links">
      {[1, 2, 3, 4, 5].map(level => (
        <a href={`/learn/level-${level}/quiz/`} class="quiz-link">
          <span class="level-dot" style={`background-color: ${levelColors[level]}`}></span>
          Level {level}
        </a>
      ))}
    </div>
  </div>
</nav>
```

Styling (use CSS logical properties throughout):
- Desktop (>= 1024px): position: sticky, inset-block-start: 72px (header + spacing), inline-size: 280px
- Mobile (< 1024px): position: fixed, inset: 0, z-index: 40, transform: translateX(-100%)
- RTL: transform: translateX(100%) when closed
- Open state: .course-navigator.open { transform: translateX(0); }
- Backdrop: Separate div .navigator-backdrop with fixed position, rgba(0,0,0,0.5), z-index: 39
- Level header: Flex row, gap 0.75rem, full width button, hover bg-secondary
- Chevron rotates 90deg when aria-expanded="true" (RTL: -90deg)
- Lesson list: padding-inline-start: 1.5rem, gap 0.125rem
- Active lesson: background accent-primary, color text-inverse
- Focus indicators: 2px solid accent-primary, offset 2px
- Smooth transitions: 300ms cubic-bezier(0.4, 0, 0.2, 1)

Important: Use `hidden` attribute for collapsed sections, not display:none in CSS (accessibility)
  </action>
  <verify>
- File exists at src/components/navigation/CourseNavigator.astro
- Contains getCollection('lessons')
- Contains aria-label="Course navigation"
- Has 5 level sections with aria-expanded
- Uses CSS logical properties (inline-size, inset-block-start)
  </verify>
  <done>CourseNavigator displays all lessons in collapsible level sections with checkmarks</done>
</task>

<task type="auto">
  <name>Task 2: Create NavigatorToggle component</name>
  <files>src/components/navigation/NavigatorToggle.astro</files>
  <action>
Create NavigatorToggle.astro - a button to toggle the CourseNavigator sidebar visibility.

This component will be used:
1. In the Header on mobile/tablet views
2. Floating on lesson pages when content area is wide enough

Structure:
```astro
---
interface Props {
  class?: string;
  variant?: 'header' | 'floating';
}

const { class: className, variant = 'header' } = Astro.props;
---

<button
  type="button"
  class:list={['navigator-toggle', `navigator-toggle--${variant}`, className]}
  id="navigator-toggle"
  aria-label="Toggle course navigator"
  aria-expanded="false"
  aria-controls="course-navigator"
>
  <svg class="menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
    <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"/>
  </svg>
  <svg class="close-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
  </svg>
</button>

<style>
  .navigator-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
    inline-size: 40px;
    block-size: 40px;
    border: 1px solid var(--border-primary);
    border-radius: var(--radius-lg);
    background: transparent;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all var(--transition-fast);
  }

  .navigator-toggle:hover {
    background: var(--bg-secondary);
    color: var(--text-primary);
    border-color: var(--border-secondary);
  }

  .navigator-toggle:focus-visible {
    outline: 2px solid var(--accent-primary);
    outline-offset: 2px;
  }

  .navigator-toggle svg {
    inline-size: 20px;
    block-size: 20px;
  }

  .close-icon {
    display: none;
  }

  .navigator-toggle[aria-expanded="true"] .menu-icon {
    display: none;
  }

  .navigator-toggle[aria-expanded="true"] .close-icon {
    display: block;
  }

  /* Header variant: visible on tablet/mobile only */
  .navigator-toggle--header {
    display: none;
  }

  @media (max-width: 1023px) {
    .navigator-toggle--header {
      display: flex;
    }
  }

  /* Floating variant: fixed position for quick access */
  .navigator-toggle--floating {
    position: fixed;
    inset-block-end: 1.5rem;
    inset-inline-start: 1.5rem;
    z-index: 30;
    inline-size: 48px;
    block-size: 48px;
    border-radius: var(--radius-full);
    background: var(--accent-primary);
    color: var(--text-inverse);
    border: none;
    box-shadow: var(--shadow-lg);
  }

  .navigator-toggle--floating:hover {
    background: var(--accent-primary);
    filter: brightness(1.1);
    color: var(--text-inverse);
  }

  /* Hide floating on desktop where sidebar is visible */
  @media (min-width: 1024px) {
    .navigator-toggle--floating {
      display: none;
    }
  }
</style>
```

Note: The actual toggle behavior (opening/closing navigator) will be wired in Plan 03 via JavaScript.
  </action>
  <verify>
- File exists at src/components/navigation/NavigatorToggle.astro
- Contains aria-expanded attribute
- Contains aria-controls="course-navigator"
- Has both menu-icon and close-icon
- CSS uses logical properties
  </verify>
  <done>NavigatorToggle button exists with header and floating variants</done>
</task>

</tasks>

<verification>
1. Both components exist in src/components/navigation/
2. CourseNavigator queries all lessons with getCollection
3. CourseNavigator has 5 level sections
4. NavigatorToggle has proper ARIA attributes
5. All CSS uses logical properties
6. Build passes: `npm run build`
</verification>

<success_criteria>
- CourseNavigator shows all 73 lessons across 5 collapsible levels
- LessonCheckmark integrated for progress indication
- NavigatorToggle has header and floating variants
- ARIA disclosure pattern implemented for level sections
- CSS is RTL-ready with logical properties
- Build passes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/05-navigation-system/05-02-SUMMARY.md`
</output>
