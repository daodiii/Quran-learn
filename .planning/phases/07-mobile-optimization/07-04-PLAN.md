---
phase: 07-mobile-optimization
plan: 04
type: execute
wave: 3
depends_on: ["07-01", "07-02", "07-03"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Lighthouse mobile score is 90 or above"
    - "Arabic text readable at 18px+ on iOS (confirmed on real device)"
    - "All success criteria from Phase 7 verified on mobile devices"
  artifacts: []
  key_links: []
---

<objective>
Run Lighthouse mobile audit and prepare for real device verification.

Purpose: Establish Lighthouse mobile performance baseline and generate verification checklist for real iOS device testing. This plan includes a checkpoint for human verification on real hardware.

Output: Lighthouse mobile score documented. Verification checklist for iOS device testing ready.
</objective>

<execution_context>
@/Users/daodilyas/.claude/get-shit-done/workflows/execute-plan.md
@/Users/daodilyas/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-mobile-optimization/07-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run Lighthouse mobile audit</name>
  <files></files>
  <action>
Run Lighthouse mobile performance audit on key pages:

1. Start the dev server if not running:
```bash
npm run dev
```

2. Run Lighthouse CLI in mobile mode on homepage:
```bash
npx lighthouse http://localhost:4321/ --preset=perf --emulated-form-factor=mobile --output=json --output-path=.planning/phases/07-mobile-optimization/lighthouse-home.json
```

3. Run on a lesson page with Arabic content:
```bash
npx lighthouse http://localhost:4321/learn/level-1/introduction-arabic-language/ --preset=perf --emulated-form-factor=mobile --output=json --output-path=.planning/phases/07-mobile-optimization/lighthouse-lesson.json
```

4. Extract and document scores from JSON output. Key metrics to capture:
- Performance score
- First Contentful Paint (FCP)
- Largest Contentful Paint (LCP)
- Total Blocking Time (TBT)
- Cumulative Layout Shift (CLS)

5. If score is below 90, identify top opportunities from the audit results.

Note: The --preset=perf focuses on performance metrics. If Lighthouse CLI is not available, the audit can be run from Chrome DevTools Lighthouse tab with Mobile device simulation enabled.
  </action>
  <verify>
Lighthouse JSON files exist in .planning/phases/07-mobile-optimization/.
Performance score is 90 or above for both pages.
  </verify>
  <done>
Lighthouse mobile audit complete. Performance scores documented. If below 90, optimization opportunities identified.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete mobile optimization suite including:
- iOS text-size-adjust to prevent font inflation
- 44px minimum touch targets on all interactive elements
- Swipe gesture to close sidebar overlay
- Horizontal scroll prevention at 320px viewport
- Responsive images with srcset for MDX content
- Lighthouse mobile performance audit
  </what-built>
  <how-to-verify>
Test on a real iOS device (iPhone or iPad). Simulators do not accurately represent iOS font rendering.

**Test checklist:**

1. **Arabic text readability (iOS)**
   - Open a lesson page with Arabic content (e.g., /learn/level-1/introduction-arabic-language/)
   - Verify Arabic text is readable (18px+ minimum)
   - Rotate device to landscape - verify text size does NOT change unexpectedly
   - Check diacritical marks (harakat) are clearly visible

2. **Touch targets**
   - In CourseNavigator, tap level headers - should feel comfortable (not too small)
   - Tap lesson links in the list - each should be easy to hit accurately
   - Tap quiz links at bottom of navigator
   - Tap close button (X) in mobile sidebar

3. **Swipe gesture**
   - Open the sidebar on mobile (tap navigator toggle)
   - Swipe left on the sidebar panel - it should close
   - Re-open and verify swiping down (scrolling) does NOT close it

4. **Horizontal scroll**
   - Open any page
   - Verify no horizontal scrollbar at any viewport width
   - Test at narrowest width (320px if possible via responsive mode)

5. **Responsive images**
   - View a lesson page with images
   - Verify images scale appropriately on mobile
   - Check loading performance (images should lazy load)

6. **Overall mobile experience**
   - Navigate through several pages
   - Test in both light and dark mode
   - Verify no visual glitches or layout breaks
  </how-to-verify>
  <resume-signal>
Type "approved" if all checks pass, or describe issues found.
If no iOS device available, type "skip-device-test" to proceed with simulator/browser testing only.
  </resume-signal>
</task>

</tasks>

<verification>
1. Lighthouse mobile score >= 90
2. All iOS device test checklist items verified
3. No critical issues found during manual testing
</verification>

<success_criteria>
- Lighthouse mobile performance score is 90 or above
- Arabic text readable on real iOS device
- Text-size-adjust prevents landscape font inflation
- All touch targets comfortable to tap
- Swipe gesture closes sidebar reliably
- No horizontal scrolling at any viewport width
- User approves mobile experience
</success_criteria>

<output>
After completion, create `.planning/phases/07-mobile-optimization/07-04-SUMMARY.md`
</output>
