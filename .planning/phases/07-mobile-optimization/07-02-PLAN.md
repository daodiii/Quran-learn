---
phase: 07-mobile-optimization
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/scripts/navigation.ts
  - src/styles/global.css
autonomous: true

must_haves:
  truths:
    - "User can swipe left on sidebar to close it on mobile"
    - "No horizontal scrollbar appears at 320px viewport width"
    - "Images and media elements constrained to container width"
  artifacts:
    - path: "src/scripts/navigation.ts"
      provides: "Swipe gesture detection for sidebar"
      contains: "touchstart"
    - path: "src/styles/global.css"
      provides: "Horizontal scroll prevention CSS"
      contains: "max-inline-size: 100%"
  key_links:
    - from: "navigation.ts"
      to: "course-navigator element"
      via: "touchstart/touchend event listeners"
      pattern: "addEventListener.*touch"
---

<objective>
Implement swipe gesture for mobile sidebar close and prevent horizontal scrolling at narrow viewports.

Purpose: Improve mobile UX with natural swipe-to-close gesture for the sidebar overlay and ensure no horizontal overflow at 320px viewport (minimum WCAG testing width).

Output: Updated navigation.ts with swipe gesture detection. Updated global.css with overflow prevention rules.
</objective>

<execution_context>
@/Users/daodilyas/.claude/get-shit-done/workflows/execute-plan.md
@/Users/daodilyas/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-mobile-optimization/07-RESEARCH.md
@src/scripts/navigation.ts
@src/styles/global.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add swipe gesture detection to navigation.ts</name>
  <files>src/scripts/navigation.ts</files>
  <action>
Add swipe gesture functionality to close the sidebar. Update navigation.ts:

1. Add swipe gesture variables after the existing State section (around line 11):
```typescript
// Swipe gesture state
let touchStartX = 0;
let touchStartY = 0;
```

2. Create a new function for swipe gesture initialization:
```typescript
// Swipe gesture for mobile sidebar close
function initSwipeGesture(): void {
  const sidebar = document.getElementById(SIDEBAR_ID);
  if (!sidebar) return;

  sidebar.addEventListener('touchstart', handleTouchStart, { passive: true });
  sidebar.addEventListener('touchend', handleTouchEnd, { passive: true });
}

function handleTouchStart(e: TouchEvent): void {
  touchStartX = e.changedTouches[0].screenX;
  touchStartY = e.changedTouches[0].screenY;
}

function handleTouchEnd(e: TouchEvent): void {
  const touchEndX = e.changedTouches[0].screenX;
  const touchEndY = e.changedTouches[0].screenY;

  const deltaX = touchEndX - touchStartX;
  const deltaY = touchEndY - touchStartY;
  const threshold = 50; // minimum swipe distance in pixels

  // Only register horizontal swipe if it's more horizontal than vertical
  if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > threshold) {
    const isRtl = document.dir === 'rtl';

    // Swipe left in LTR closes sidebar, swipe right in RTL closes sidebar
    if ((!isRtl && deltaX < 0) || (isRtl && deltaX > 0)) {
      closeSidebar();
    }
  }
}
```

3. Call initSwipeGesture() from initNavigation() function (after initLevelSections call):
```typescript
export function initNavigation(): void {
  initSidebarToggle();
  initLevelSections();
  initSwipeGesture(); // Add this line
  restoreLevelStates();
  scrollActiveLessonIntoView();
}
```

Note: Using { passive: true } for touch event listeners improves scroll performance. The 50px threshold prevents accidental swipes during scrolling. RTL support handles swipe direction correctly.
  </action>
  <verify>
Run `grep -n "touchstart" src/scripts/navigation.ts` to confirm touch events added.
Run `grep -n "initSwipeGesture" src/scripts/navigation.ts` to confirm function exists.
Run `npm run build` to ensure TypeScript compiles without errors.
  </verify>
  <done>
Swipe gesture detection added to navigation.ts. Swiping left (LTR) or right (RTL) on sidebar closes it. Uses 50px threshold and passive event listeners.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add horizontal scroll prevention CSS</name>
  <files>src/styles/global.css</files>
  <action>
Add CSS rules to prevent horizontal scrolling at narrow viewports. Add to @layer base section (after the body styles, around line 313):

```css
/* Horizontal scroll prevention - ensures no overflow at 320px viewport */
img,
video,
iframe,
embed,
object,
canvas,
svg:not([aria-hidden="true"]) {
  max-inline-size: 100%;
  block-size: auto;
}

/* Prevent wide tables from causing overflow */
table {
  display: block;
  max-inline-size: 100%;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
}

/* Ensure pre/code blocks don't overflow */
pre,
code {
  max-inline-size: 100%;
  overflow-x: auto;
  word-wrap: break-word;
}

/* Container overflow constraint */
.content-wrapper,
.prose,
main {
  max-inline-size: 100%;
  overflow-wrap: break-word;
}
```

Note: Using CSS logical properties (max-inline-size, block-size) for RTL compatibility. The svg:not([aria-hidden="true"]) selector avoids affecting decorative icons.
  </action>
  <verify>
Run `grep -n "max-inline-size: 100%" src/styles/global.css` to confirm rules added.
Run `npm run build` to ensure no build errors.
  </verify>
  <done>
Horizontal scroll prevention CSS added. Images, videos, iframes, tables, and code blocks constrained to container width. Container elements have overflow-wrap: break-word.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. `grep -rn "touchstart" src/scripts/` shows swipe gesture handlers
3. `grep -rn "max-inline-size: 100%" src/styles/` shows overflow prevention rules
</verification>

<success_criteria>
- Swipe gesture detection implemented in navigation.ts with passive event listeners
- RTL-aware swipe direction handling (left in LTR, right in RTL)
- 50px threshold prevents accidental swipes during scrolling
- Images, videos, iframes constrained to 100% max-width
- Tables scroll horizontally when content exceeds container
- Pre/code blocks handle overflow gracefully
- Build passes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/07-mobile-optimization/07-02-SUMMARY.md`
</output>
