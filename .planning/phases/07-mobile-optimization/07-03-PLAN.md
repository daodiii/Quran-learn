---
phase: 07-mobile-optimization
plan: 03
type: execute
wave: 2
depends_on: ["07-01", "07-02"]
files_modified:
  - src/components/mdx/ResponsiveImage.astro
  - src/pages/learn/[...slug].astro
autonomous: true

must_haves:
  truths:
    - "Images in MDX content display responsively with srcset"
    - "Lesson pages use responsive image component for MDX images"
  artifacts:
    - path: "src/components/mdx/ResponsiveImage.astro"
      provides: "Responsive image wrapper using Astro Picture"
      contains: "Picture"
    - path: "src/pages/learn/[...slug].astro"
      provides: "MDX component override for images"
      contains: "ResponsiveImage"
  key_links:
    - from: "lesson pages"
      to: "ResponsiveImage component"
      via: "MDX components prop"
      pattern: "components.*img.*ResponsiveImage"
---

<objective>
Create responsive image component for MDX content and integrate into lesson pages.

Purpose: Ensure images in lesson MDX content are automatically responsive with srcset generation, improving mobile performance and visual quality across devices.

Output: New ResponsiveImage.astro component using Astro's Picture. Updated lesson pages with MDX component override for images.
</objective>

<execution_context>
@/Users/daodilyas/.claude/get-shit-done/workflows/execute-plan.md
@/Users/daodilyas/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-mobile-optimization/07-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ResponsiveImage component</name>
  <files>src/components/mdx/ResponsiveImage.astro</files>
  <action>
Create a new directory and component for responsive images in MDX content:

1. Create src/components/mdx/ directory if it doesn't exist

2. Create src/components/mdx/ResponsiveImage.astro:
```astro
---
/**
 * ResponsiveImage - Wrapper for MDX images with responsive srcset
 *
 * Provides automatic responsive image handling for lesson content.
 * Falls back to standard img tag for external URLs.
 */
import { Picture } from 'astro:assets';

interface Props {
  src: string | ImageMetadata;
  alt: string;
  class?: string;
  width?: number;
  height?: number;
}

const { src, alt, class: className, width, height } = Astro.props;

// Check if src is an external URL
const isExternal = typeof src === 'string' && (src.startsWith('http://') || src.startsWith('https://'));
---

{isExternal ? (
  <img
    src={src}
    alt={alt}
    class:list={['responsive-image', className]}
    width={width}
    height={height}
    loading="lazy"
    decoding="async"
  />
) : (
  <Picture
    src={src}
    alt={alt}
    widths={[320, 640, 960, 1280]}
    sizes="(max-width: 640px) 100vw, (max-width: 1024px) 70ch, 960px"
    formats={['avif', 'webp']}
    class:list={['responsive-image', className]}
    loading="lazy"
    decoding="async"
  />
)}

<style>
  .responsive-image {
    max-inline-size: 100%;
    block-size: auto;
    border-radius: var(--radius-lg);
    margin-block: var(--space-lg);
  }
</style>
```

Note: The component handles both local images (using Astro Picture for optimization) and external URLs (using standard img tag). The widths array covers common mobile/tablet/desktop sizes. The sizes attribute ensures proper image selection based on viewport.
  </action>
  <verify>
Run `ls -la src/components/mdx/` to confirm directory and file exist.
Run `grep -n "Picture" src/components/mdx/ResponsiveImage.astro` to confirm Picture import.
  </verify>
  <done>
ResponsiveImage.astro component created in src/components/mdx/. Handles local images with Astro Picture (srcset, avif/webp formats) and external URLs with standard img tag. Includes responsive sizing and lazy loading.
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate ResponsiveImage into lesson pages</name>
  <files>src/pages/learn/[...slug].astro</files>
  <action>
Update the lesson page to use ResponsiveImage for MDX content images.

1. Read the current lesson page structure
2. Add import for ResponsiveImage component
3. Add components prop to Content component to override img

The pattern should be:
```astro
---
import ResponsiveImage from '../../components/mdx/ResponsiveImage.astro';
// ... other imports
---

// In the template where Content is rendered:
<Content components={{ img: ResponsiveImage }} />
```

Note: The exact implementation depends on the current page structure. The Content component from Astro content collections accepts a components prop that allows overriding default HTML elements.
  </action>
  <verify>
Run `grep -n "ResponsiveImage" src/pages/learn/` to confirm import and usage.
Run `npm run build` to ensure build succeeds.
  </verify>
  <done>
Lesson pages import and use ResponsiveImage component via MDX components override. Images in lesson MDX content automatically use responsive srcset.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. Component file exists at src/components/mdx/ResponsiveImage.astro
3. Lesson page imports and uses ResponsiveImage component
</verification>

<success_criteria>
- ResponsiveImage component exists and uses Astro Picture for local images
- Component generates srcset with widths [320, 640, 960, 1280]
- Component outputs avif and webp formats
- External URLs fall back to standard img tag
- Lesson pages override MDX img element with ResponsiveImage
- Build passes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/07-mobile-optimization/07-03-SUMMARY.md`
</output>
