---
phase: 10-curriculum-planning---standards
plan: 03
type: execute
wave: 2
depends_on: ["10-02"]
files_modified:
  - scripts/validate-content.ts
  - scripts/validate-diacritics.ts
  - scripts/validate-terminology.ts
  - scripts/validate-verses.ts
  - scripts/fetch-quran-text.ts
  - data/quran/surah-metadata.json
  - package.json
autonomous: true

must_haves:
  truths:
    - "Running 'npm run validate' checks all lesson MDX files for diacritics, terminology, and verse reference issues"
    - "Diacritics validation detects Arabic text missing tashkeel marks"
    - "Terminology validation detects non-canonical term usage"
    - "Verse reference validation detects invalid surah numbers, verse ranges, and format errors"
    - "Build-time helper fetches Quranic verse text by surah:ayah reference from offline dataset"
    - "Surah metadata file contains all 114 surahs with names, ayah counts, and English transliterations"
  artifacts:
    - path: "scripts/validate-content.ts"
      provides: "Main validation orchestrator"
      contains: "validateContent"
    - path: "scripts/validate-diacritics.ts"
      provides: "Arabic diacritics completeness checker"
      contains: "ARABIC_LETTER"
    - path: "scripts/validate-terminology.ts"
      provides: "Canonical terminology enforcer"
      contains: "loadTerminology"
    - path: "scripts/validate-verses.ts"
      provides: "Verse reference format and range validator"
      contains: "validateVerseReference"
    - path: "scripts/fetch-quran-text.ts"
      provides: "Build-time CLI helper for looking up Quranic verses"
      contains: "getVerse"
    - path: "data/quran/surah-metadata.json"
      provides: "Authoritative surah names and ayah counts for all 114 surahs"
      contains: "Al-Fatiha"
    - path: "package.json"
      provides: "validate npm script"
      contains: "validate"
  key_links:
    - from: "scripts/validate-terminology.ts"
      to: "docs/TERMINOLOGY.md"
      via: "Loads canonical terms from TERMINOLOGY.md for enforcement"
      pattern: "TERMINOLOGY\\.md"
    - from: "scripts/validate-verses.ts"
      to: "data/quran/surah-metadata.json"
      via: "Loads surah metadata for verse reference validation"
      pattern: "surah-metadata\\.json"
    - from: "scripts/validate-content.ts"
      to: "src/content/lessons/"
      via: "Globs all MDX files in lesson directories for validation"
      pattern: "content/lessons"
---

<objective>
Create automated validation scripts and build-time Quranic text helper to enforce content standards across all 73 lessons.

Purpose: Manual content review cannot catch diacritics omissions, terminology drift, or verse reference errors across 73 lessons. These scripts provide automated guardrails that run before commits, catching errors early. The Quran text helper enables content authors to look up accurate, fully-vocalized verse text during authoring (build-time only, NOT runtime per REQUIREMENTS.md).

Output: 5 TypeScript scripts in `scripts/`, 1 data file in `data/quran/`, and npm script entries in `package.json`.
</objective>

<execution_context>
@/Users/daodilyas/.claude/get-shit-done/workflows/execute-plan.md
@/Users/daodilyas/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-curriculum-planning---standards/10-RESEARCH.md
@.planning/phases/10-curriculum-planning---standards/10-02-SUMMARY.md
@package.json
@tsconfig.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create surah metadata and validation scripts</name>
  <files>
    data/quran/surah-metadata.json
    scripts/validate-diacritics.ts
    scripts/validate-terminology.ts
    scripts/validate-verses.ts
    scripts/validate-content.ts
  </files>
  <action>
**Step 1: Create `data/quran/` directory and `surah-metadata.json`:**

Create a JSON file containing all 114 surahs with this structure:
```json
{
  "surahs": [
    { "number": 1, "name": "Al-Fatiha", "nameArabic": "الفاتحة", "ayahs": 7, "revelation": "meccan" },
    { "number": 2, "name": "Al-Baqarah", "nameArabic": "البقرة", "ayahs": 286, "revelation": "medinan" },
    ...all 114 surahs...
  ]
}
```

Include all 114 surahs with accurate ayah counts. This is critical for verse reference validation. Use standard English transliteration for surah names (matching the format in STYLE_GUIDE.md).

**Step 2: Create `scripts/validate-diacritics.ts`:**

TypeScript script that checks Arabic text for complete tashkeel (per LSSN-07).

Key implementation details:
- Unicode ranges: Arabic letters \u0621-\u063A and \u0641-\u064A, diacritics \u064B-\u065F
- Extract Arabic text segments from MDX content (skip frontmatter delimited by ---, code blocks, import lines, and JSX component attributes)
- For each Arabic segment, count letters vs diacritics
- Quranic text should have diacritics ratio >= 0.7 (most letters need harakat, exceptions: alif after fatha, waw/ya as long vowels)
- Export a `validateDiacritics(content: string, filename: string)` function returning array of `{line: number, message: string, severity: 'error' | 'warning'}`
- Handle edge cases: don't count alif lam (ال) as missing diacritics, skip empty lines

**Step 3: Create `scripts/validate-terminology.ts`:**

TypeScript script that enforces canonical bilingual terminology from TERMINOLOGY.md (per PDGY-03).

Key implementation details:
- Read `docs/TERMINOLOGY.md` and parse the markdown tables to extract canonical terms (English, Arabic, Transliteration columns)
- For each lesson MDX file, find Arabic grammar terms (match against canonical Arabic column)
- Check that first mention of each term in the lesson uses the bilingual format: "English (transliteration / Arabic)" or linked variant
- Export a `validateTerminology(content: string, filename: string)` function returning validation errors
- Only check grammar terms (from TERMINOLOGY.md), not general Arabic text
- Parse markdown tables by splitting on `|` and trimming whitespace

**Step 4: Create `scripts/validate-verses.ts`:**

TypeScript script that validates Quranic verse references (per STYLE_GUIDE format).

Key implementation details:
- Load `data/quran/surah-metadata.json` for authoritative surah data
- Find all verse references matching pattern `\[.+?\s+\d+:\d+(?:-\d+)?\]`
- For each reference, validate: (a) surah number is 1-114, (b) surah name matches metadata, (c) verse number(s) are within ayah count range
- Export a `validateVerses(content: string, filename: string)` function returning validation errors
- Handle verse ranges: [Al-Baqarah 2:255-256] — both start and end must be valid
- Warn (not error) on surah name capitalization mismatches

**Step 5: Create `scripts/validate-content.ts`:**

Main orchestrator that runs all three validators on all lesson MDX files.

Key implementation details:
- Use Node.js `fs` and `path` modules to find all `*.mdx` files in `src/content/lessons/`
- Use `fs.readdirSync` with recursive option or manual recursion through level-1 through level-5 subdirectories
- For each MDX file, read content and run: validateDiacritics, validateTerminology, validateVerses
- Aggregate results and output formatted report to stdout
- Exit with code 1 if any errors found, 0 if clean
- Skip files starting with `_` (index files) and draft files
- Print summary: "X files checked, Y errors, Z warnings"

All scripts should be written as ES modules (the project uses `"type": "module"` in package.json). Use Node.js built-in `fs/promises` and `path` modules. Do NOT add any new npm dependencies for validation — use only Node.js built-ins and string processing. This keeps the validation lightweight.

Scripts should be executable with `npx tsx scripts/validate-content.ts` (tsx is the standard TypeScript runner that works with ES modules).
  </action>
  <verify>
1. Verify `data/quran/surah-metadata.json` exists and contains 114 surah entries
2. Verify all 4 script files exist in `scripts/` directory
3. Check that validate-content.ts imports from the other 3 validators
4. Check that validate-verses.ts references surah-metadata.json
5. Check that validate-terminology.ts references TERMINOLOGY.md
6. Verify scripts use ES module syntax (import/export, not require)
  </verify>
  <done>
Four validation scripts and surah metadata file are created. validate-content.ts orchestrates validate-diacritics.ts, validate-terminology.ts, and validate-verses.ts to check all lesson MDX files. surah-metadata.json contains all 114 surahs with accurate ayah counts.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Quran text helper and add npm scripts</name>
  <files>
    scripts/fetch-quran-text.ts
    package.json
  </files>
  <action>
**Step 1: Create `scripts/fetch-quran-text.ts`:**

A BUILD-TIME helper script for content authors to look up Quranic verse text during lesson authoring. This is NOT a runtime API — it outputs to stdout for copy-paste into MDX files.

Key implementation details:
- CLI usage: `npx tsx scripts/fetch-quran-text.ts 2:255` or `npx tsx scripts/fetch-quran-text.ts "Al-Baqarah 2:255"`
- Load surah metadata from `data/quran/surah-metadata.json` for name lookup
- Since we don't have the full Tanzil dataset yet (to be downloaded separately), the script should:
  1. Accept a verse reference argument (chapter:verse format)
  2. Validate the reference against surah-metadata.json
  3. Output the reference info (surah name, chapter, verse number)
  4. Print instructions: "Verse text must be sourced from an authoritative Quran text (e.g., Tanzil.net simple format) and pasted with full tashkeel."
  5. Include a `--format mdx` flag that outputs a ready-to-paste ArabicExample component template:
     ```
     <ArabicExample
       arabic="[PASTE VERSE TEXT HERE]"
       translation="[PASTE TRANSLATION HERE]"
       reference="Al-Fatiha 1:1"
     />
     ```
- Export a `getVerseInfo(reference: string)` function for programmatic use
- Handle both "2:255" and "Al-Baqarah 2:255" input formats

This approach respects the REQUIREMENTS.md constraint: "Content should be frozen in MDX; no runtime dependencies." The script is a helper for human authors, not a build-time fetcher.

**Step 2: Update `package.json` with validation and helper scripts:**

Add these scripts to the "scripts" section of package.json (preserve all existing scripts):

```json
"validate": "npx tsx scripts/validate-content.ts",
"validate:diacritics": "npx tsx scripts/validate-diacritics.ts",
"validate:terminology": "npx tsx scripts/validate-terminology.ts",
"validate:verses": "npx tsx scripts/validate-verses.ts",
"quran:lookup": "npx tsx scripts/fetch-quran-text.ts"
```

Also add `tsx` as a devDependency if not already present:
```bash
npm install --save-dev tsx
```

Do NOT modify any existing scripts in package.json. Only ADD new entries.
  </action>
  <verify>
1. Verify `scripts/fetch-quran-text.ts` exists and exports getVerseInfo
2. Run `npm run validate --help` or check package.json to verify the script entry exists
3. Verify package.json has all 5 new script entries (validate, validate:diacritics, validate:terminology, validate:verses, quran:lookup)
4. Verify tsx is in devDependencies
5. Verify all existing package.json scripts are preserved unchanged
  </verify>
  <done>
Build-time Quran text helper script created with CLI interface for verse lookup and MDX template generation. package.json updated with 5 new npm scripts (validate, validate:diacritics, validate:terminology, validate:verses, quran:lookup) and tsx devDependency. All existing scripts preserved.
  </done>
</task>

</tasks>

<verification>
1. `npm run validate` executes without syntax errors (may report 0 files if lessons are empty)
2. `npx tsx scripts/fetch-quran-text.ts 1:1` outputs Al-Fatiha verse info
3. `data/quran/surah-metadata.json` contains 114 surah entries
4. All scripts use ES module syntax and import from each other correctly
5. package.json has all new script entries AND all original scripts intact
</verification>

<success_criteria>
- Automated validation scripts check diacritics, terminology consistency, and verse references
- Build-time Quran text helper provides verse lookup for content authors
- All scripts runnable via npm scripts without additional setup
- No runtime API calls — all tools are build-time/authoring-time only
</success_criteria>

<output>
After completion, create `.planning/phases/10-curriculum-planning---standards/10-03-SUMMARY.md`
</output>
