---
phase: 02-progress-primitive-components
plan: 03
type: execute
wave: 2
depends_on: ["02-01", "02-02"]
files_modified:
  - src/pages/test/components.astro
  - tests/components.spec.ts
autonomous: false

must_haves:
  truths:
    - "Test page renders all 7 components in various states"
    - "Components display correctly in LTR mode"
    - "Components display correctly in RTL mode"
    - "Components display correctly in dark mode"
    - "Playwright tests pass for visual regression"
    - "ARIA attributes verified in automated tests"
  artifacts:
    - path: "src/pages/test/components.astro"
      provides: "Component showcase page"
      min_lines: 100
    - path: "tests/components.spec.ts"
      provides: "Playwright component tests"
      min_lines: 50
  key_links:
    - from: "tests/components.spec.ts"
      to: "/test/components"
      via: "URL navigation"
      pattern: "page.goto.*test/components"
    - from: "components.astro"
      to: "All 7 components"
      via: "Import statements"
      pattern: "import.*from.*components/(progress|primitives)"
---

<objective>
Create a component test page and Playwright tests to verify all 7 components work correctly in LTR, RTL, and dark mode.

Purpose: Validate that components meet accessibility requirements (ARIA), RTL support works via CSS logical properties, and visual appearance is consistent across themes.

Output: Test page at `/test/components` showcasing all components, Playwright test suite verifying functionality and capturing visual regression baselines.
</objective>

<execution_context>
@/Users/daodilyas/.claude/get-shit-done/workflows/execute-plan.md
@/Users/daodilyas/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-progress-primitive-components/02-RESEARCH.md

# Components from this phase
@src/components/progress/ProgressBar.astro
@src/components/progress/ProgressRing.astro
@src/components/progress/LessonCheckmark.astro
@src/components/primitives/Button.astro
@src/components/primitives/Badge.astro
@src/components/primitives/Card.astro
@src/components/primitives/Container.astro

# Existing test setup
@tests/font-verification.spec.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create component showcase test page</name>
  <files>src/pages/test/components.astro</files>
  <action>
Create a test page that renders all 7 components in various states:

**Page structure:**
```astro
---
import Layout from '../../layouts/Layout.astro';
import ProgressBar from '../../components/progress/ProgressBar.astro';
import ProgressRing from '../../components/progress/ProgressRing.astro';
import LessonCheckmark from '../../components/progress/LessonCheckmark.astro';
import Button from '../../components/primitives/Button.astro';
import Badge from '../../components/primitives/Badge.astro';
import Card from '../../components/primitives/Card.astro';
import Container from '../../components/primitives/Container.astro';
---
```

**Sections to include:**

1. **Progress Components Section:**
   - ProgressBar at 0%, 25%, 50%, 75%, 100%
   - ProgressBar with showPercentage=true
   - ProgressBar in sm, md, lg heights
   - ProgressRing at 0/10, 3/10, 7/10, 10/10
   - ProgressRing at different sizes (80, 120, 160)
   - LessonCheckmark completed=true
   - LessonCheckmark completed=false
   - LessonCheckmark with showLabel=true

2. **Button Component Section:**
   - All 4 variants (primary, secondary, outline, ghost)
   - All 3 sizes (sm, md, lg)
   - Disabled state
   - Link mode (with href)

3. **Badge Component Section:**
   - All 5 semantic variants (default, success, warning, error, info)
   - All 5 level badges (level 1-5)
   - Both sizes (sm, md)

4. **Card Component Section:**
   - All 3 variants (default, elevated, outlined)
   - All 4 padding options
   - Clickable card
   - Card as link

5. **Container Component Section:**
   - Visual examples of different max-widths

**Data attributes for testing:**
- Add `data-testid` attributes to each component instance for Playwright targeting
- Example: `data-testid="progress-bar-50"`

**Layout:**
- Use existing Layout component
- Group sections with headings
- Include theme toggle button for manual dark mode testing
  </action>
  <verify>
- File exists at src/pages/test/components.astro
- Imports all 7 components
- Has sections for progress, button, badge, card, container
- Has data-testid attributes for testing
- Shows multiple states/variants of each component
  </verify>
  <done>
Test page at /test/components showcases all 7 components with multiple states, variants, and sizes, ready for Playwright testing.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Playwright component tests</name>
  <files>tests/components.spec.ts</files>
  <action>
Create Playwright test suite for component verification:

**Test structure:**
```typescript
import { test, expect } from '@playwright/test';

test.describe('Phase 2 Components', () => {
  test.beforeEach(async ({ page }) => {
    await page.goto('/test/components');
  });

  // Progress components tests
  test.describe('ProgressBar', () => {
    test('renders with ARIA attributes', async ({ page }) => {
      const progressBar = page.locator('[data-testid="progress-bar-50"]');
      await expect(progressBar.locator('[role="progressbar"]')).toBeVisible();
      await expect(progressBar.locator('[role="progressbar"]')).toHaveAttribute('aria-valuenow', '50');
      await expect(progressBar.locator('[role="progressbar"]')).toHaveAttribute('aria-valuemin', '0');
      await expect(progressBar.locator('[role="progressbar"]')).toHaveAttribute('aria-valuemax', '100');
    });

    test('has accessible label', async ({ page }) => {
      const progressBar = page.locator('[data-testid="progress-bar-50"]');
      const ariaLabel = await progressBar.locator('[role="progressbar"]').getAttribute('aria-label');
      const ariaLabelledby = await progressBar.locator('[role="progressbar"]').getAttribute('aria-labelledby');
      expect(ariaLabel || ariaLabelledby).toBeTruthy();
    });
  });

  test.describe('ProgressRing', () => {
    test('renders with ARIA attributes', async ({ page }) => {
      const ring = page.locator('[data-testid="progress-ring-7-10"]');
      await expect(ring.locator('[role="progressbar"]')).toBeVisible();
    });
  });

  test.describe('LessonCheckmark', () => {
    test('has accessible role', async ({ page }) => {
      const checkmark = page.locator('[data-testid="checkmark-complete"]');
      await expect(checkmark.locator('[role="img"]')).toBeVisible();
      await expect(checkmark.locator('[role="img"]')).toHaveAttribute('aria-label');
    });
  });

  // Button tests
  test.describe('Button', () => {
    test('renders all variants', async ({ page }) => {
      await expect(page.locator('[data-testid="btn-primary"]')).toBeVisible();
      await expect(page.locator('[data-testid="btn-secondary"]')).toBeVisible();
      await expect(page.locator('[data-testid="btn-outline"]')).toBeVisible();
      await expect(page.locator('[data-testid="btn-ghost"]')).toBeVisible();
    });

    test('disabled button has correct attributes', async ({ page }) => {
      const disabledBtn = page.locator('[data-testid="btn-disabled"]');
      await expect(disabledBtn).toBeDisabled();
    });

    test('link button renders as anchor', async ({ page }) => {
      const linkBtn = page.locator('[data-testid="btn-link"]');
      await expect(linkBtn).toHaveAttribute('href');
    });
  });

  // Badge tests
  test.describe('Badge', () => {
    test('renders all levels', async ({ page }) => {
      for (let i = 1; i <= 5; i++) {
        await expect(page.locator(`[data-testid="badge-level-${i}"]`)).toBeVisible();
      }
    });
  });

  // RTL test
  test.describe('RTL Support', () => {
    test('components work in RTL mode', async ({ page }) => {
      await page.evaluate(() => {
        document.documentElement.setAttribute('dir', 'rtl');
      });
      // Verify layout doesn't break
      await expect(page.locator('[data-testid="progress-bar-50"]')).toBeVisible();
      await expect(page.locator('[data-testid="btn-primary"]')).toBeVisible();
    });
  });

  // Dark mode test
  test.describe('Dark Mode', () => {
    test('components render in dark mode', async ({ page }) => {
      await page.evaluate(() => {
        document.documentElement.setAttribute('data-theme', 'dark');
      });
      // Verify components visible
      await expect(page.locator('[data-testid="progress-bar-50"]')).toBeVisible();

      // Verify background color changed (dark mode uses different tokens)
      const bgColor = await page.evaluate(() => {
        return getComputedStyle(document.body).backgroundColor;
      });
      expect(bgColor).toBe('rgb(15, 15, 15)'); // #0f0f0f dark mode bg
    });
  });

  // Visual regression tests
  test.describe('Visual Regression', () => {
    test('LTR mode snapshot', async ({ page }) => {
      await expect(page).toHaveScreenshot('components-ltr.png', {
        maxDiffPixelRatio: 0.02
      });
    });

    test('RTL mode snapshot', async ({ page }) => {
      await page.evaluate(() => {
        document.documentElement.setAttribute('dir', 'rtl');
      });
      await page.waitForTimeout(100); // Allow reflow
      await expect(page).toHaveScreenshot('components-rtl.png', {
        maxDiffPixelRatio: 0.02
      });
    });

    test('Dark mode snapshot', async ({ page }) => {
      await page.evaluate(() => {
        document.documentElement.setAttribute('data-theme', 'dark');
      });
      await page.waitForTimeout(100); // Allow reflow
      await expect(page).toHaveScreenshot('components-dark.png', {
        maxDiffPixelRatio: 0.02
      });
    });
  });
});
```

**Test coverage:**
- ARIA attribute verification for all progress components
- All button variants render correctly
- All badge variants render correctly
- Disabled state works on buttons
- Link mode renders anchor tag
- RTL mode doesn't break layout
- Dark mode applies correctly
- Visual regression snapshots for LTR, RTL, dark modes
  </action>
  <verify>
- File exists at tests/components.spec.ts
- Has test.describe blocks for each component type
- Verifies ARIA attributes on progress components
- Has RTL mode test
- Has dark mode test
- Has visual regression tests with toHaveScreenshot
  </verify>
  <done>
Playwright test suite verifies ARIA accessibility, RTL support, dark mode, and captures visual regression baselines for all 7 components.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Component test page and Playwright test suite for all 7 Phase 2 components</what-built>
  <how-to-verify>
1. Start the dev server: `npm run dev`
2. Visit http://localhost:4321/test/components
3. Verify all components render correctly:
   - Progress bars at different percentages
   - Progress rings with X/Y counts
   - Checkmarks in complete/incomplete states
   - Buttons in all 4 variants
   - Badges in all semantic and level variants
   - Cards in all variants
4. Click the theme toggle to verify dark mode
5. Run tests: `npx playwright test tests/components.spec.ts`
6. Verify all tests pass and visual snapshots are captured
  </how-to-verify>
  <resume-signal>Type "approved" if components look correct and tests pass, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
After all tasks complete:

1. Verify test page exists and is accessible:
```bash
curl -s http://localhost:4321/test/components | head -20
```

2. Run Playwright tests:
```bash
npx playwright test tests/components.spec.ts --reporter=list
```

3. Verify visual snapshots were created:
```bash
ls -la tests/components.spec.ts-snapshots/
```

4. Verify test coverage includes RTL and dark mode:
```bash
grep -E "rtl|dark" tests/components.spec.ts
```
</verification>

<success_criteria>
- Test page exists at /test/components
- Page imports and renders all 7 components
- Components have data-testid attributes for testing
- Playwright tests verify ARIA attributes
- RTL mode test passes (layout doesn't break)
- Dark mode test passes (theme applies correctly)
- Visual regression snapshots captured for LTR, RTL, dark modes
- All Playwright tests pass
- User approves visual appearance
</success_criteria>

<output>
After completion, create `.planning/phases/02-progress-primitive-components/02-03-SUMMARY.md`
</output>
