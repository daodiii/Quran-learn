---
phase: 17-qa-validation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [scripts/validate-diacritics.ts, scripts/validate-terminology.ts, scripts/validate-consistency.ts, scripts/validate-content.ts, package.json]
autonomous: true
---

# Plan 17-01: Fix Validator Bugs + Cross-Lesson Consistency Validator

## Completed

### Diacritics Validator Fixes (validate-diacritics.ts)
- Expanded Unicode diacritics range: added dagger alif (U+0670), hamza above/below (U+0654-0656), Quranic marks (U+06D6-06DC, U+06E5-06E8)
- Increased minimum letter threshold from 3 to 4 (eliminates false positives on 3-letter words like قَالَ)
- Added tiered thresholds: 55% for 4-6 letters, 65% for 7-11 letters, 70% for 12+ letters
- Improved JSX attribute skipping (all key="value" patterns, not just specific attributes)
- Added JSX expression {content} skipping
- Errors below 40% vocalization are errors; 40-threshold are warnings

### Terminology Validator Fixes (validate-terminology.ts)
- Added regex special character escaping for term.english (fixes parentheses crash)
- Filter out terms with <3 base Arabic letters (eliminates أَ, إِ, أَل false positives)
- Skip markdown headings, JSX component lines, import lines
- Track frontmatter and code blocks properly
- Added broader bilingual format pattern matching

### Cross-Lesson Consistency Validator (validate-consistency.ts) — NEW
- Component import consistency (used but not imported)
- Import path format validation (@components/mdx/ standard)
- Frontmatter validation (title, level, order required)
- Duplicate order detection within levels
- Exercise count check (minimum 3 per lesson)
- ArabicExample count check (minimum 2 per lesson)
- Level lesson count validation (11, 11, 18, 17, 16)

### Integration
- Updated validate-content.ts to include link validation and scan resources
- Added validate:consistency npm script

## Results
- Errors: 1,587 → 52 (97% reduction)
- Warnings: 323 → 1,039 (many former errors now warnings + new link warnings)
- Remaining 52 errors are genuine: 47 unvocalized Arabic text, 5 surah name mismatches
