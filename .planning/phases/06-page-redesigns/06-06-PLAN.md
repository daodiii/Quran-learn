---
phase: 06-page-redesigns
plan: 06
type: execute
wave: 2
depends_on: ["06-03"]
files_modified:
  - src/components/Quiz.astro
  - src/pages/learn/level-1/quiz.astro
  - src/pages/learn/level-2/quiz.astro
  - src/pages/learn/level-3/quiz.astro
  - src/pages/learn/level-4/quiz.astro
  - src/pages/learn/level-5/quiz.astro
autonomous: true

must_haves:
  truths:
    - "Quiz shows one question at a time with clear focus"
    - "Progress bar indicates question N of 10"
    - "Answer options have clear visual states (hover, selected, correct, incorrect)"
    - "Immediate feedback shown after answer selection"
    - "Results screen shows score with pass/fail indication"
  artifacts:
    - path: "src/components/Quiz.astro"
      provides: "Clean, focused quiz component"
      contains: "quiz-option"
  key_links:
    - from: "src/components/Quiz.astro"
      to: "src/components/progress/ProgressBar.astro"
      via: "import"
      pattern: "ProgressBar"
---

<objective>
Redesign the quiz experience with clean interface, clear feedback, and focused single-question display.

Purpose: Quizzes test comprehension - a clean, focused interface reduces cognitive load and provides clear feedback to support learning.
Output: Updated Quiz.astro component with design tokens and improved UX
</objective>

<execution_context>
@/Users/daodilyas/.claude/get-shit-done/workflows/execute-plan.md
@/Users/daodilyas/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-page-redesigns/06-RESEARCH.md
@src/components/Quiz.astro
@src/components/progress/ProgressBar.astro
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update Quiz Component Structure and Imports</name>
  <files>src/components/Quiz.astro</files>
  <action>
Update Quiz.astro to use design tokens and ProgressBar component:

1. Add ProgressBar import at top:
   ```astro
   ---
   import ProgressBar from './progress/ProgressBar.astro';
   import { saveQuizScore } from '../lib/progress';
   import { getCurrentUser } from '../lib/auth';

   interface Props {
     level: number;
     questions: Question[];
     passingScore?: number;
   }

   interface Question {
     id: string;
     question: string;
     questionArabic?: string;
     options: string[];
     correctIndex: number;
     explanation: string;
   }

   const { level, questions, passingScore = 8 } = Astro.props;
   ---
   ```

2. Update the quiz container structure to use semantic HTML:
   ```astro
   <div class="quiz-container" id="quiz-app" data-questions={JSON.stringify(questions)} data-passing-score={passingScore} data-level={level}>
     <!-- Start Screen -->
     <section class="quiz-screen quiz-start" id="start-screen">
       <div class="quiz-intro">
         <h2 class="quiz-title">Level {level} Quiz</h2>
         <p class="quiz-desc">
           Test your understanding of the concepts covered in Level {level}.
           You need {passingScore} correct answers to pass.
         </p>
         <div class="quiz-meta">
           <span class="meta-item">
             <strong>10</strong> Questions
           </span>
           <span class="meta-item">
             <strong>{passingScore}/10</strong> to Pass
           </span>
         </div>
         <button type="button" class="btn-primary btn-start" id="start-btn">
           Start Quiz
         </button>
       </div>
     </section>

     <!-- Question Screen -->
     <section class="quiz-screen quiz-question" id="question-screen" hidden>
       <!-- Content populated by JavaScript -->
     </section>

     <!-- Results Screen -->
     <section class="quiz-screen quiz-results" id="results-screen" hidden>
       <!-- Content populated by JavaScript -->
     </section>
   </div>
   ```

3. Add base container styling with design tokens:
   ```css
   .quiz-container {
     max-inline-size: 640px;
     margin-inline: auto;
     padding: var(--spacing-lg);
   }

   .quiz-screen {
     animation: fadeIn 0.3s ease-out;
   }

   .quiz-screen[hidden] {
     display: none;
   }

   @keyframes fadeIn {
     from { opacity: 0; transform: translateY(10px); }
     to { opacity: 1; transform: translateY(0); }
   }

   .quiz-title {
     font-size: 1.5rem;
     font-weight: 700;
     color: var(--text-primary);
     margin-block-end: var(--spacing-sm);
   }

   .quiz-desc {
     font-size: 1rem;
     color: var(--text-secondary);
     line-height: 1.6;
     margin-block-end: var(--spacing-lg);
   }

   .quiz-meta {
     display: flex;
     gap: var(--spacing-lg);
     margin-block-end: var(--spacing-xl);
   }

   .meta-item {
     font-size: 0.9375rem;
     color: var(--text-secondary);
   }

   .meta-item strong {
     color: var(--text-primary);
   }

   .btn-start {
     padding: var(--spacing-md) var(--spacing-xl);
     font-size: 1rem;
   }
   ```
  </action>
  <verify>
Run `npm run build` - verify Quiz component compiles without errors.
  </verify>
  <done>
Quiz component uses design tokens.
ProgressBar imported for question progress.
Clean start screen structure in place.
  </done>
</task>

<task type="auto">
  <name>Task 2: Redesign Question Screen with Clear Feedback</name>
  <files>src/components/Quiz.astro</files>
  <action>
Update the JavaScript to render question screen with improved UX:

1. Update the renderQuestion function in the script section:
   ```javascript
   function renderQuestion() {
     const q = selectedQuestions[currentIndex];
     const questionScreen = document.getElementById('question-screen');

     questionScreen.innerHTML = `
       <div class="question-progress">
         <p class="progress-text">Question ${currentIndex + 1} of ${selectedQuestions.length}</p>
         <div class="progress-bar-wrapper">
           <div
             role="progressbar"
             aria-valuenow="${currentIndex + 1}"
             aria-valuemin="1"
             aria-valuemax="${selectedQuestions.length}"
             aria-label="Quiz progress"
             class="progress-bar"
           >
             <div class="progress-fill" style="width: ${((currentIndex + 1) / selectedQuestions.length) * 100}%"></div>
           </div>
         </div>
       </div>

       <div class="question-content">
         <h2 class="question-text">${q.question}</h2>
         ${q.questionArabic ? `<p class="question-arabic" lang="ar">${q.questionArabic}</p>` : ''}
       </div>

       <div class="quiz-options" role="radiogroup" aria-labelledby="question-text">
         ${q.options.map((opt, i) => `
           <button
             type="button"
             class="quiz-option"
             data-index="${i}"
             role="radio"
             aria-checked="false"
           >
             <span class="option-label">${String.fromCharCode(65 + i)}</span>
             <span class="option-text">${opt}</span>
           </button>
         `).join('')}
       </div>

       <div class="quiz-feedback" id="feedback" hidden>
         <div class="feedback-content"></div>
       </div>

       <div class="quiz-nav">
         <button type="button" class="btn-secondary" id="next-btn" disabled>
           ${currentIndex < selectedQuestions.length - 1 ? 'Next Question' : 'See Results'}
         </button>
       </div>
     `;

     // Attach option click handlers
     const options = questionScreen.querySelectorAll('.quiz-option');
     options.forEach(opt => {
       opt.addEventListener('click', () => selectOption(parseInt(opt.dataset.index)));
     });

     // Attach next button handler
     document.getElementById('next-btn').addEventListener('click', nextQuestion);
   }
   ```

2. Update selectOption function for visual feedback:
   ```javascript
   function selectOption(index) {
     const q = selectedQuestions[currentIndex];
     const isCorrect = index === q.correctIndex;
     const options = document.querySelectorAll('.quiz-option');
     const feedback = document.getElementById('feedback');
     const nextBtn = document.getElementById('next-btn');

     // Disable all options after selection
     options.forEach((opt, i) => {
       opt.disabled = true;
       opt.setAttribute('aria-checked', i === index ? 'true' : 'false');

       if (i === q.correctIndex) {
         opt.setAttribute('data-state', 'correct');
       } else if (i === index && !isCorrect) {
         opt.setAttribute('data-state', 'incorrect');
       }
     });

     // Track score
     if (isCorrect) {
       score++;
     } else {
       wrongAnswers.push({ question: q, selected: index });
     }

     // Show feedback
     feedback.hidden = false;
     feedback.querySelector('.feedback-content').innerHTML = isCorrect
       ? `<div class="feedback-correct">
            <svg class="feedback-icon" viewBox="0 0 24 24" width="24" height="24">
              <path fill="currentColor" d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
            </svg>
            <div>
              <strong>Correct!</strong>
              <p>${q.explanation}</p>
            </div>
          </div>`
       : `<div class="feedback-incorrect">
            <svg class="feedback-icon" viewBox="0 0 24 24" width="24" height="24">
              <path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
            </svg>
            <div>
              <strong>Incorrect</strong>
              <p>The correct answer was: ${q.options[q.correctIndex]}</p>
              <p class="feedback-explanation">${q.explanation}</p>
            </div>
          </div>`;

     // Enable next button
     nextBtn.disabled = false;
   }
   ```

3. Add question and feedback styling:
   ```css
   .question-progress {
     margin-block-end: var(--spacing-lg);
   }

   .progress-text {
     font-size: 0.875rem;
     color: var(--text-secondary);
     margin-block-end: var(--spacing-xs);
   }

   .progress-bar {
     block-size: 8px;
     background: var(--bg-tertiary);
     border-radius: var(--radius-full);
     overflow: hidden;
   }

   .progress-fill {
     block-size: 100%;
     background: var(--accent-primary);
     transition: width 0.3s ease;
   }

   .question-content {
     margin-block-end: var(--spacing-lg);
   }

   .question-text {
     font-size: 1.25rem;
     font-weight: 600;
     color: var(--text-primary);
     line-height: 1.4;
   }

   .question-arabic {
     font-family: var(--font-arabic);
     font-size: 1.75rem;
     line-height: 2;
     direction: rtl;
     color: var(--text-primary);
     margin-block-start: var(--spacing-md);
   }

   .quiz-options {
     display: flex;
     flex-direction: column;
     gap: var(--spacing-sm);
     margin-block-end: var(--spacing-lg);
   }

   .quiz-option {
     display: flex;
     align-items: center;
     gap: var(--spacing-md);
     padding: var(--spacing-md);
     background: var(--bg-elevated);
     border: 2px solid var(--border-primary);
     border-radius: var(--radius-lg);
     text-align: start;
     cursor: pointer;
     transition: all var(--transition-fast);
   }

   .quiz-option:hover:not(:disabled) {
     border-color: var(--accent-primary);
     background: var(--accent-primary-light);
   }

   .quiz-option:disabled {
     cursor: not-allowed;
   }

   .quiz-option[data-state="correct"] {
     border-color: #059669;
     background: #ecfdf5;
   }

   .quiz-option[data-state="incorrect"] {
     border-color: #dc2626;
     background: #fef2f2;
   }

   [data-theme="dark"] .quiz-option[data-state="correct"] {
     background: rgba(16, 185, 129, 0.15);
   }

   [data-theme="dark"] .quiz-option[data-state="incorrect"] {
     background: rgba(239, 68, 68, 0.15);
   }

   .option-label {
     flex-shrink: 0;
     display: flex;
     align-items: center;
     justify-content: center;
     inline-size: 2rem;
     block-size: 2rem;
     background: var(--bg-secondary);
     border-radius: var(--radius-full);
     font-weight: 600;
     color: var(--text-primary);
   }

   .option-text {
     flex: 1;
     font-size: 0.9375rem;
     color: var(--text-primary);
   }

   .quiz-feedback {
     padding: var(--spacing-md);
     border-radius: var(--radius-lg);
     margin-block-end: var(--spacing-lg);
   }

   .feedback-correct {
     display: flex;
     align-items: flex-start;
     gap: var(--spacing-sm);
     background: #ecfdf5;
     border: 1px solid #059669;
     padding: var(--spacing-md);
     border-radius: var(--radius-lg);
   }

   .feedback-incorrect {
     display: flex;
     align-items: flex-start;
     gap: var(--spacing-sm);
     background: #fef2f2;
     border: 1px solid #dc2626;
     padding: var(--spacing-md);
     border-radius: var(--radius-lg);
   }

   [data-theme="dark"] .feedback-correct {
     background: rgba(16, 185, 129, 0.15);
   }

   [data-theme="dark"] .feedback-incorrect {
     background: rgba(239, 68, 68, 0.15);
   }

   .feedback-icon {
     flex-shrink: 0;
     margin-block-start: 2px;
   }

   .feedback-correct .feedback-icon {
     color: #059669;
   }

   .feedback-incorrect .feedback-icon {
     color: #dc2626;
   }

   .feedback-explanation {
     font-size: 0.875rem;
     color: var(--text-secondary);
     margin-block-start: var(--spacing-xs);
   }

   .quiz-nav {
     display: flex;
     justify-content: flex-end;
   }
   ```
  </action>
  <verify>
Run `npm run dev` and test quiz flow:
1. Start quiz
2. Select an answer - should show feedback
3. Click Next - should advance to next question
4. Progress bar should update
  </verify>
  <done>
Question screen shows one question at a time.
Progress bar indicates current question.
Answer selection shows immediate feedback.
Next button enabled after answer.
  </done>
</task>

<task type="auto">
  <name>Task 3: Redesign Results Screen with Pass/Fail</name>
  <files>src/components/Quiz.astro</files>
  <action>
Update the results screen rendering with clear pass/fail indication:

1. Update showResults function:
   ```javascript
   async function showResults() {
     const passed = score >= passingScore;
     const percentage = Math.round((score / selectedQuestions.length) * 100);
     const resultsScreen = document.getElementById('results-screen');

     resultsScreen.innerHTML = `
       <div class="results-container ${passed ? 'results-passed' : 'results-failed'}">
         <div class="results-icon">
           ${passed
             ? `<svg viewBox="0 0 24 24" width="64" height="64"><path fill="currentColor" d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>`
             : `<svg viewBox="0 0 24 24" width="64" height="64"><path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>`
           }
         </div>

         <h2 class="results-title">${passed ? 'Congratulations!' : 'Keep Practicing'}</h2>

         <p class="results-message">
           ${passed
             ? `You passed the Level ${level} quiz with a score of ${score}/${selectedQuestions.length}.`
             : `You scored ${score}/${selectedQuestions.length}. You need ${passingScore} correct answers to pass.`
           }
         </p>

         <div class="results-score">
           <div class="score-circle">
             <span class="score-value">${percentage}%</span>
           </div>
           <p class="score-label">${score} of ${selectedQuestions.length} correct</p>
         </div>

         ${wrongAnswers.length > 0 ? `
           <div class="results-review">
             <h3 class="review-title">Review Incorrect Answers</h3>
             <div class="review-list">
               ${wrongAnswers.map((item, i) => `
                 <div class="review-item">
                   <p class="review-question">${i + 1}. ${item.question.question}</p>
                   <p class="review-answer">
                     <span class="answer-wrong">Your answer: ${item.question.options[item.selected]}</span>
                     <span class="answer-correct">Correct: ${item.question.options[item.question.correctIndex]}</span>
                   </p>
                 </div>
               `).join('')}
             </div>
           </div>
         ` : ''}

         <div class="results-actions">
           <button type="button" class="btn-primary" id="retry-btn">
             Try Again
           </button>
           <a href="/learn/#level-${level}" class="btn-secondary">
             Back to Lessons
           </a>
         </div>
       </div>
     `;

     // Attach retry handler
     document.getElementById('retry-btn').addEventListener('click', () => {
       resetQuiz();
       showScreen('start');
     });

     // Save score if user is authenticated
     try {
       const user = await getCurrentUser();
       if (user) {
         await saveQuizScore(level, score, selectedQuestions.length, passed);
       }
     } catch (e) {
       console.log('Score not saved - user not authenticated');
     }
   }
   ```

2. Add results styling:
   ```css
   .results-container {
     text-align: center;
     padding: var(--spacing-xl);
   }

   .results-icon {
     margin-block-end: var(--spacing-lg);
   }

   .results-passed .results-icon {
     color: #059669;
   }

   .results-failed .results-icon {
     color: #dc2626;
   }

   .results-title {
     font-size: 1.75rem;
     font-weight: 700;
     color: var(--text-primary);
     margin-block-end: var(--spacing-sm);
   }

   .results-message {
     font-size: 1rem;
     color: var(--text-secondary);
     margin-block-end: var(--spacing-lg);
   }

   .results-score {
     margin-block-end: var(--spacing-xl);
   }

   .score-circle {
     display: inline-flex;
     align-items: center;
     justify-content: center;
     inline-size: 100px;
     block-size: 100px;
     border-radius: var(--radius-full);
     border: 4px solid var(--accent-primary);
     margin-block-end: var(--spacing-sm);
   }

   .results-passed .score-circle {
     border-color: #059669;
   }

   .results-failed .score-circle {
     border-color: #dc2626;
   }

   .score-value {
     font-size: 1.5rem;
     font-weight: 700;
     color: var(--text-primary);
   }

   .score-label {
     font-size: 0.875rem;
     color: var(--text-secondary);
   }

   .results-review {
     text-align: start;
     margin-block-end: var(--spacing-xl);
     padding: var(--spacing-md);
     background: var(--bg-secondary);
     border-radius: var(--radius-lg);
   }

   .review-title {
     font-size: 1rem;
     font-weight: 600;
     color: var(--text-primary);
     margin-block-end: var(--spacing-md);
   }

   .review-list {
     display: flex;
     flex-direction: column;
     gap: var(--spacing-md);
   }

   .review-item {
     padding-block-end: var(--spacing-sm);
     border-block-end: 1px solid var(--border-primary);
   }

   .review-item:last-child {
     border: none;
     padding-block-end: 0;
   }

   .review-question {
     font-size: 0.9375rem;
     color: var(--text-primary);
     margin-block-end: var(--spacing-xs);
   }

   .answer-wrong {
     color: #dc2626;
     font-size: 0.875rem;
     display: block;
   }

   .answer-correct {
     color: #059669;
     font-size: 0.875rem;
     display: block;
   }

   .results-actions {
     display: flex;
     justify-content: center;
     gap: var(--spacing-md);
     flex-wrap: wrap;
   }
   ```

3. Add helper functions if not present:
   ```javascript
   function showScreen(screen) {
     document.getElementById('start-screen').hidden = screen !== 'start';
     document.getElementById('question-screen').hidden = screen !== 'question';
     document.getElementById('results-screen').hidden = screen !== 'results';
   }

   function resetQuiz() {
     currentIndex = 0;
     score = 0;
     wrongAnswers = [];
     selectedQuestions = shuffle(questions).slice(0, 10);
   }
   ```
  </action>
  <verify>
Run `npm run dev` and complete a full quiz:
1. Answer all 10 questions
2. Results screen should show pass/fail
3. Incorrect answers should be listed
4. "Try Again" should reset quiz
5. Test both passing and failing scenarios
  </verify>
  <done>
Results screen clearly shows pass/fail status.
Score displayed as percentage and fraction.
Incorrect answers listed for review.
Try Again and Back to Lessons actions work.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm run build` completes without errors
2. Quiz shows clean start screen
3. Questions display one at a time with progress bar
4. Answer selection provides immediate feedback
5. Results screen shows clear pass/fail
6. Dark mode works throughout quiz
</verification>

<success_criteria>
- QUIZ-01 satisfied: Clean, focused quiz experience with clear feedback
- Single question focus reduces cognitive load
- Progress bar tracks quiz advancement
- Immediate feedback supports learning
- Results clearly indicate pass/fail
- Build passes with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/06-page-redesigns/06-06-SUMMARY.md`
</output>
