---
phase: 06-page-redesigns
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/pages/learn/index.astro
autonomous: true

must_haves:
  truths:
    - "Learn dashboard displays all 5 levels as CourseCard modules"
    - "Each level card shows lesson count and progress bar"
    - "Level sections are anchored (scrollable via #level-N)"
    - "Each level expands to show LessonCard list"
    - "Progress indicators client-side populated from localStorage"
  artifacts:
    - path: "src/pages/learn/index.astro"
      provides: "Module-based learn dashboard"
      contains: "CourseCard"
  key_links:
    - from: "src/pages/learn/index.astro"
      to: "src/components/cards/CourseCard.astro"
      via: "import"
      pattern: "import CourseCard"
    - from: "src/pages/learn/index.astro"
      to: "src/components/cards/LessonCard.astro"
      via: "import"
      pattern: "import LessonCard"
---

<objective>
Redesign the learn dashboard with module-based layout showing level progress and expandable lesson lists.

Purpose: The learn dashboard is the curriculum hub - users need clear level progression with visual progress tracking and easy access to lessons.
Output: Redesigned learn/index.astro using CourseCard, LessonCard, CardGrid, and design tokens
</objective>

<execution_context>
@/Users/daodilyas/.claude/get-shit-done/workflows/execute-plan.md
@/Users/daodilyas/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-page-redesigns/06-RESEARCH.md
@src/pages/learn/index.astro
@src/components/cards/CourseCard.astro
@src/components/cards/LessonCard.astro
@src/components/cards/CardGrid.astro
</context>

<tasks>

<task type="auto">
  <name>Task 1: Redesign Learn Dashboard Header and Level Cards</name>
  <files>src/pages/learn/index.astro</files>
  <action>
Refactor learn/index.astro to use module-based layout with CourseCard components:

1. Import required components at top:
   ```astro
   import BaseLayout from '../../layouts/BaseLayout.astro';
   import CardGrid from '../../components/cards/CardGrid.astro';
   import CourseCard from '../../components/cards/CourseCard.astro';
   import LessonCard from '../../components/cards/LessonCard.astro';
   import { getCollection } from 'astro:content';

   const allLessons = await getCollection('lessons');
   ```

2. Define level metadata:
   ```astro
   const levels = [
     { num: 1, title: 'Foundation', titleAr: 'الأساسيات', desc: 'Arabic alphabet, vowels, basic word structure.' },
     { num: 2, title: 'Core Grammar', titleAr: 'القواعد الأساسية', desc: 'Nominal/verbal sentences, I\'rab cases, Idafah.' },
     { num: 3, title: 'Intermediate', titleAr: 'القواعد المتوسطة', desc: 'Verb forms I-X, participles, passive voice.' },
     { num: 4, title: 'Advanced', titleAr: 'القواعد المتقدمة', desc: 'Hal, Tamyeez, conditionals, emphasis.' },
     { num: 5, title: 'Applied Study', titleAr: 'التطبيق القرآني', desc: 'Quranic patterns, I\'rab analysis, rhetoric.' },
   ];
   ```

3. Create page header section:
   ```astro
   <section class="page-header">
     <h1 class="page-title">Grammar Curriculum</h1>
     <p class="page-subtitle">
       73 lessons across 5 progressive levels. Master Quranic Arabic grammar from alphabet to full analysis.
     </p>
   </section>
   ```

4. Create overview CardGrid with CourseCard for each level:
   ```astro
   <section class="levels-overview">
     <CardGrid gap="md">
       {levels.map(level => {
         const levelLessons = allLessons.filter(l => l.data.level === level.num);
         return (
           <CourseCard
             title={level.title}
             level={level.num}
             lessonsCompleted={0}
             totalLessons={levelLessons.length}
             href={`#level-${level.num}`}
             data-level-overview={level.num}
           >
             {level.desc}
           </CourseCard>
         );
       })}
     </CardGrid>
   </section>
   ```

5. Style the page header with design tokens:
   ```css
   .learn-page {
     max-inline-size: 80rem;
     margin-inline: auto;
     padding: var(--spacing-xl) var(--spacing-md);
   }

   .page-header {
     margin-block-end: var(--spacing-xl);
     max-inline-size: 640px;
   }

   .page-title {
     font-size: clamp(1.75rem, 4vw, 2.25rem);
     font-weight: 700;
     color: var(--text-primary);
     margin-block-end: var(--spacing-sm);
   }

   .page-subtitle {
     font-size: 1rem;
     color: var(--text-secondary);
     line-height: 1.6;
   }
   ```
  </action>
  <verify>
Run `npm run build` - verify no import or type errors.
Check that page header and 5 CourseCard components render.
  </verify>
  <done>
Learn dashboard header uses design tokens.
5 CourseCard components display level overview.
Cards link to #level-N anchors on same page.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Expandable Level Sections with Lesson Lists</name>
  <files>src/pages/learn/index.astro</files>
  <action>
Add level sections below the overview, each containing a LessonCard list:

1. Create level sections with anchor IDs:
   ```astro
   {levels.map(level => {
     const levelLessons = allLessons
       .filter(l => l.data.level === level.num)
       .sort((a, b) => a.data.order - b.data.order);

     return (
       <section class="level-section" id={`level-${level.num}`}>
         <div class="level-header">
           <h2 class="level-title">
             <span class="level-badge" data-level={level.num}>Level {level.num}</span>
             {level.title}
           </h2>
           <p class="level-title-ar">{level.titleAr}</p>
         </div>

         <div class="lesson-list">
           {levelLessons.map(lesson => (
             <LessonCard
               title={lesson.data.title}
               titleArabic={lesson.data.titleArabic}
               order={lesson.data.order}
               level={lesson.data.level}
               completed={false}
               href={`/learn/${lesson.id}/`}
               data-lesson-slug={lesson.id}
             />
           ))}
         </div>
       </section>
     );
   })}
   ```

2. Style level sections:
   ```css
   .level-section {
     margin-block-end: var(--spacing-2xl);
     scroll-margin-block-start: var(--spacing-lg);
   }

   .level-header {
     margin-block-end: var(--spacing-md);
     padding-block-end: var(--spacing-sm);
     border-block-end: 1px solid var(--border-primary);
   }

   .level-title {
     font-size: 1.5rem;
     font-weight: 700;
     color: var(--text-primary);
     display: flex;
     align-items: center;
     gap: var(--spacing-sm);
   }

   .level-badge {
     display: inline-flex;
     padding: var(--spacing-xs) var(--spacing-sm);
     background: var(--level-1-bg);
     color: var(--level-1-text);
     border-radius: var(--radius-sm);
     font-size: 0.75rem;
     font-weight: 600;
     text-transform: uppercase;
   }

   .level-badge[data-level="2"] { background: var(--level-2-bg); color: var(--level-2-text); }
   .level-badge[data-level="3"] { background: var(--level-3-bg); color: var(--level-3-text); }
   .level-badge[data-level="4"] { background: var(--level-4-bg); color: var(--level-4-text); }
   .level-badge[data-level="5"] { background: var(--level-5-bg); color: var(--level-5-text); }

   .level-title-ar {
     font-family: var(--font-arabic);
     font-size: 1.125rem;
     color: var(--text-secondary);
     margin-block-start: var(--spacing-xs);
   }

   .lesson-list {
     display: flex;
     flex-direction: column;
     gap: var(--spacing-sm);
   }
   ```

3. Remove old accordion/toggle behavior if present - lessons always visible (simpler UX).
  </action>
  <verify>
Run `npm run build` - verify all 73 lessons render correctly.
Navigate to /learn/#level-3 and verify scroll-to anchor works.
  </verify>
  <done>
5 level sections with anchor IDs exist.
Each section displays LessonCard list for that level.
Clicking CourseCard scrolls to corresponding level section.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add Client-Side Progress Population</name>
  <files>src/pages/learn/index.astro</files>
  <action>
Add client-side script to populate progress from localStorage:

1. Add script at bottom of file:
   ```html
   <script>
     // Populate lesson completion states from localStorage
     document.addEventListener('DOMContentLoaded', () => {
       // Get completed lessons from localStorage
       const completedLessons = JSON.parse(localStorage.getItem('completedLessons') || '[]');

       // Update LessonCard completion states
       const lessonCards = document.querySelectorAll('[data-lesson-slug]');
       lessonCards.forEach(card => {
         const slug = card.getAttribute('data-lesson-slug');
         if (completedLessons.includes(slug)) {
           // Add completed class for styling
           card.classList.add('completed');
           // Update checkmark if present
           const checkmark = card.querySelector('[data-testid="lesson-checkmark"]');
           if (checkmark) {
             checkmark.setAttribute('data-completed', 'true');
           }
         }
       });

       // Calculate level progress and update overview cards
       const levelOverviews = document.querySelectorAll('[data-level-overview]');
       levelOverviews.forEach(card => {
         const level = card.getAttribute('data-level-overview');
         const levelLessons = document.querySelectorAll(`[data-lesson-slug^="level-${level}/"]`);
         const completed = Array.from(levelLessons).filter(l => l.classList.contains('completed')).length;

         // Store for CourseCard progress display
         localStorage.setItem(`level-${level}-completed`, String(completed));

         // Update progress bar if present
         const progressBar = card.querySelector('[role="progressbar"]');
         if (progressBar) {
           progressBar.setAttribute('aria-valuenow', String(completed));
           // Update visual bar width
           const fill = progressBar.querySelector('.progress-fill');
           if (fill && levelLessons.length > 0) {
             fill.style.width = `${(completed / levelLessons.length) * 100}%`;
           }
         }
       });
     });
   </script>
   ```

2. Add CSS for completed lesson styling:
   ```css
   .lesson-list [data-lesson-slug].completed {
     opacity: 0.8;
   }

   .lesson-list [data-lesson-slug].completed .lesson-checkmark {
     color: var(--color-success);
   }
   ```

3. Note: This uses localStorage pattern per STATE.md blocker note. Future Supabase sync deferred.
  </action>
  <verify>
Run `npm run dev` and test:
1. Mark a lesson as complete via DevTools: `localStorage.setItem('completedLessons', '["level-1/01-arabic-alphabet"]')`
2. Refresh page - lesson should show completed state
3. Level 1 progress bar should update
  </verify>
  <done>
Lesson completion states load from localStorage.
Progress bars update based on completed lessons count.
Visual completed state applies to LessonCard.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm run build` completes without errors
2. Learn dashboard shows 5 CourseCard overview cards
3. Each level section shows LessonCard list
4. Clicking level card scrolls to level section
5. localStorage-based progress tracking works
6. Dark mode works throughout the page
</verification>

<success_criteria>
- LEARN-01 satisfied: Module-based learn dashboard with level progress
- All 73 lessons accessible from learn dashboard
- Progress indicators work via localStorage
- Design tokens used consistently
- Build passes with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/06-page-redesigns/06-02-SUMMARY.md`
</output>
